diff --git a/output/frameworks_av/6801b4db-e3c56d16-1de23936/drm@libdrmframework@plugins@forward-lock@FwdLockEngine@src@FwdLockEngine.no_comments_mergebot.cpp b/output/frameworks_av/6801b4db-e3c56d16-1de23936/drm@libdrmframework@plugins@forward-lock@FwdLockEngine@src@FwdLockEngine.no_comments_truth.cpp
index 928221d..5cdba2c 100644
--- a/output/frameworks_av/6801b4db-e3c56d16-1de23936/drm@libdrmframework@plugins@forward-lock@FwdLockEngine@src@FwdLockEngine.no_comments_mergebot.cpp
+++ b/output/frameworks_av/6801b4db-e3c56d16-1de23936/drm@libdrmframework@plugins@forward-lock@FwdLockEngine@src@FwdLockEngine.no_comments_truth.cpp
@@ -40,5 +39,0 @@ FwdLockEngine::FwdLockEngine() {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine Construction");
-||||||| 1de2393648
-    LOGD("FwdLockEngine Construction");
-=======
@@ -46 +40,0 @@ FwdLockEngine::FwdLockEngine() {
->>>>>>> e3c56d16
@@ -49,5 +42,0 @@ FwdLockEngine::~FwdLockEngine() {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine Destruction");
-||||||| 1de2393648
-    LOGD("FwdLockEngine Destruction");
-=======
@@ -55 +43,0 @@ FwdLockEngine::~FwdLockEngine() {
->>>>>>> e3c56d16
@@ -92,5 +79,0 @@ DrmConstraints* FwdLockEngine::onGetConstraints(int uniqueId, const String8* pat
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onGetConstraints");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onGetConstraints");
-=======
@@ -98 +80,0 @@ DrmConstraints* FwdLockEngine::onGetConstraints(int uniqueId, const String8* pat
->>>>>>> e3c56d16
@@ -107,5 +88,0 @@ DrmMetadata* FwdLockEngine::onGetMetadata(int uniqueId, const String8* path) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onGetMetadata");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onGetMetadata");
-=======
@@ -113 +89,0 @@ DrmMetadata* FwdLockEngine::onGetMetadata(int uniqueId, const String8* path) {
->>>>>>> e3c56d16
@@ -120,5 +95,0 @@ android::status_t FwdLockEngine::onInitialize(int uniqueId) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onInitialize");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onInitialize");
-=======
@@ -126 +96,0 @@ android::status_t FwdLockEngine::onInitialize(int uniqueId) {
->>>>>>> e3c56d16
@@ -128,5 +97,0 @@ android::status_t FwdLockEngine::onInitialize(int uniqueId) {
-<<<<<<< HEAD
-        LOGV("FwdLockEngine::onInitialize -- FwdLockGlue_InitializeKeyEncryption succeeded");
-||||||| 1de2393648
-        LOGD("FwdLockEngine::onInitialize -- FwdLockGlue_InitializeKeyEncryption succeeded");
-=======
@@ -134 +98,0 @@ android::status_t FwdLockEngine::onInitialize(int uniqueId) {
->>>>>>> e3c56d16
@@ -143,5 +106,0 @@ FwdLockEngine::onSetOnInfoListener(int uniqueId, const IDrmEngine::OnInfoListene
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onSetOnInfoListener");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onSetOnInfoListener");
-=======
@@ -149 +107,0 @@ FwdLockEngine::onSetOnInfoListener(int uniqueId, const IDrmEngine::OnInfoListene
->>>>>>> e3c56d16
@@ -153,5 +110,0 @@ android::status_t FwdLockEngine::onTerminate(int uniqueId) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onTerminate");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onTerminate");
-=======
@@ -159 +111,0 @@ android::status_t FwdLockEngine::onTerminate(int uniqueId) {
->>>>>>> e3c56d16
@@ -164,5 +115,0 @@ DrmSupportInfo* FwdLockEngine::onGetSupportInfo(int uniqueId) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onGetSupportInfo");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onGetSupportInfo");
-=======
@@ -170 +116,0 @@ DrmSupportInfo* FwdLockEngine::onGetSupportInfo(int uniqueId) {
->>>>>>> e3c56d16
@@ -193,5 +138,0 @@ DrmInfoStatus* FwdLockEngine::onProcessDrmInfo(int uniqueId, const DrmInfo* drmI
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onProcessDrmInfo");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onProcessDrmInfo");
-=======
@@ -199 +139,0 @@ DrmInfoStatus* FwdLockEngine::onProcessDrmInfo(int uniqueId, const DrmInfo* drmI
->>>>>>> e3c56d16
@@ -207,5 +146,0 @@ status_t FwdLockEngine::onSaveRights(
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onSaveRights");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onSaveRights");
-=======
@@ -213 +147,0 @@ status_t FwdLockEngine::onSaveRights(
->>>>>>> e3c56d16
@@ -218,5 +151,0 @@ DrmInfo* FwdLockEngine::onAcquireDrmInfo(int uniqueId, const DrmInfoRequest* drm
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onAcquireDrmInfo");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onAcquireDrmInfo");
-=======
@@ -224 +152,0 @@ DrmInfo* FwdLockEngine::onAcquireDrmInfo(int uniqueId, const DrmInfoRequest* drm
->>>>>>> e3c56d16
@@ -231,5 +158,0 @@ int FwdLockEngine::onCheckRightsStatus(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onCheckRightsStatus");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onCheckRightsStatus");
-=======
@@ -237 +159,0 @@ int FwdLockEngine::onCheckRightsStatus(int uniqueId,
->>>>>>> e3c56d16
@@ -261,5 +182,0 @@ status_t FwdLockEngine::onConsumeRights(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onConsumeRights");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onConsumeRights");
-=======
@@ -267 +183,0 @@ status_t FwdLockEngine::onConsumeRights(int uniqueId,
->>>>>>> e3c56d16
@@ -274,5 +189,0 @@ bool FwdLockEngine::onValidateAction(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onValidateAction");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onValidateAction");
-=======
@@ -280 +190,0 @@ bool FwdLockEngine::onValidateAction(int uniqueId,
->>>>>>> e3c56d16
@@ -284,5 +193,0 @@ String8 FwdLockEngine::onGetOriginalMimeType(int uniqueId, const String8& path)
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onGetOriginalMimeType");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onGetOriginalMimeType");
-=======
@@ -290 +194,0 @@ String8 FwdLockEngine::onGetOriginalMimeType(int uniqueId, const String8& path)
->>>>>>> e3c56d16
@@ -308,5 +211,0 @@ int FwdLockEngine::onGetDrmObjectType(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onGetDrmObjectType");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onGetDrmObjectType");
-=======
@@ -314 +212,0 @@ int FwdLockEngine::onGetDrmObjectType(int uniqueId,
->>>>>>> e3c56d16
@@ -324,5 +221,0 @@ status_t FwdLockEngine::onRemoveRights(int uniqueId, const String8& path) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onRemoveRights");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onRemoveRights");
-=======
@@ -330 +222,0 @@ status_t FwdLockEngine::onRemoveRights(int uniqueId, const String8& path) {
->>>>>>> e3c56d16
@@ -334,5 +225,0 @@ status_t FwdLockEngine::onRemoveAllRights(int uniqueId) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onRemoveAllRights");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onRemoveAllRights");
-=======
@@ -340 +226,0 @@ status_t FwdLockEngine::onRemoveAllRights(int uniqueId) {
->>>>>>> e3c56d16
@@ -342,0 +229,4 @@ status_t FwdLockEngine::onRemoveAllRights(int uniqueId) {
+#ifdef USE_64BIT_DRM_API
+status_t FwdLockEngine::onSetPlaybackStatus(int uniqueId, DecryptHandle* decryptHandle,
+                                            int playbackStatus, int64_t position) {
+#else
@@ -346,5 +235,0 @@ status_t FwdLockEngine::onSetPlaybackStatus(int uniqueId, DecryptHandle* decrypt
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onSetPlaybackStatus");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onSetPlaybackStatus");
-=======
@@ -352 +236,0 @@ status_t FwdLockEngine::onSetPlaybackStatus(int uniqueId, DecryptHandle* decrypt
->>>>>>> e3c56d16
@@ -358,5 +241,0 @@ status_t FwdLockEngine::onOpenConvertSession(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onOpenConvertSession");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onOpenConvertSession");
-=======
@@ -364 +242,0 @@ status_t FwdLockEngine::onOpenConvertSession(int uniqueId,
->>>>>>> e3c56d16
@@ -413,5 +290,0 @@ DrmConvertedStatus* FwdLockEngine::onCloseConvertSession(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onCloseConvertSession");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onCloseConvertSession");
-=======
@@ -419 +291,0 @@ DrmConvertedStatus* FwdLockEngine::onCloseConvertSession(int uniqueId,
->>>>>>> e3c56d16
@@ -438,0 +311 @@ DrmConvertedStatus* FwdLockEngine::onCloseConvertSession(int uniqueId,
+#ifdef USE_64BIT_DRM_API
@@ -441 +314,10 @@ status_t FwdLockEngine::onOpenDecryptSession(int uniqueId,
-                                             const char* uri) {
+                                             int fd,
+                                             off64_t offset,
+                                             off64_t length) {
+#else
+status_t FwdLockEngine::onOpenDecryptSession(int uniqueId,
+                                             DecryptHandle* decryptHandle,
+                                             int fd,
+                                             int offset,
+                                             int length) {
+#endif
@@ -443,11 +325,9 @@ status_t FwdLockEngine::onOpenDecryptSession(int uniqueId,
-    const char fileTag [] = "file://";
-    if (NULL != decryptHandle && NULL != uri && strlen(uri) > sizeof(fileTag)) {
-        String8 uriTag = String8(uri);
-        uriTag.toLower();
-        if (0 == strncmp(uriTag.string(), fileTag, sizeof(fileTag) - 1)) {
-            const char *filePath = strchr(uri + sizeof(fileTag) - 1, '/');
-            if (NULL != filePath && onCanHandle(uniqueId, String8(filePath))) {
-                int fd = open(filePath, O_RDONLY);
-                if (-1 < fd) {
-                    result = onOpenDecryptSession(uniqueId, decryptHandle, fd, 0, 1);
-                    close(fd);
+    int fileDesc = -1;
+    LOG_VERBOSE("FwdLockEngine::onOpenDecryptSession");
+    if ((-1 < fd) &&
+        (NULL != decryptHandle) &&
+        (!decodeSessionMap.isCreated(decryptHandle->decryptId))) {
+        fileDesc = dup(fd);
+    } else {
+        LOGE("FwdLockEngine::onOpenDecryptSession parameter error");
+        return result;
@@ -454,0 +335,19 @@ status_t FwdLockEngine::onOpenDecryptSession(int uniqueId,
+    if (-1 < fileDesc &&
+        -1 < ::lseek(fileDesc, offset, SEEK_SET) &&
+        -1 < FwdLockFile_attach(fileDesc)) {
+        int retVal = FwdLockFile_CheckHeaderIntegrity(fileDesc);
+        DecodeSession* decodeSession = new DecodeSession(fileDesc);
+        if (retVal && NULL != decodeSession) {
+            decodeSessionMap.addValue(decryptHandle->decryptId, decodeSession);
+            const char *pmime= FwdLockFile_GetContentType(fileDesc);
+            String8 contentType = String8(pmime == NULL ? "" : pmime);
+            contentType.toLower();
+            decryptHandle->mimeType = MimeTypeUtil::convertMimeType(contentType);
+            decryptHandle->decryptApiType = DecryptApiType::CONTAINER_BASED;
+            decryptHandle->status = RightsStatus::RIGHTS_VALID;
+            decryptHandle->decryptInfo = NULL;
+            result = DRM_NO_ERROR;
+        } else {
+            LOG_VERBOSE("FwdLockEngine::onOpenDecryptSession Integrity Check failed for the fd");
+            FwdLockFile_detach(fileDesc);
+            delete decodeSession;
@@ -456,0 +356,2 @@ status_t FwdLockEngine::onOpenDecryptSession(int uniqueId,
+    if (DRM_NO_ERROR != result && -1 < fileDesc) {
+        ::close(fileDesc);
@@ -457,0 +359 @@ status_t FwdLockEngine::onOpenDecryptSession(int uniqueId,
+    LOG_VERBOSE("FwdLockEngine::onOpenDecryptSession Exit. result = %d", result);
@@ -484,5 +385,0 @@ status_t FwdLockEngine::onCloseDecryptSession(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onCloseDecryptSession");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onCloseDecryptSession");
-=======
@@ -490 +386,0 @@ status_t FwdLockEngine::onCloseDecryptSession(int uniqueId,
->>>>>>> e3c56d16
@@ -500 +395,0 @@ status_t FwdLockEngine::onCloseDecryptSession(int uniqueId,
-<<<<<<< HEAD
@@ -511,4 +405,0 @@ status_t FwdLockEngine::onCloseDecryptSession(int uniqueId,
-    LOGV("FwdLockEngine::onCloseDecryptSession Exit");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onCloseDecryptSession Exit");
-=======
@@ -516 +406,0 @@ status_t FwdLockEngine::onCloseDecryptSession(int uniqueId,
->>>>>>> e3c56d16
@@ -523,5 +412,0 @@ status_t FwdLockEngine::onInitializeDecryptUnit(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onInitializeDecryptUnit");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onInitializeDecryptUnit");
-=======
@@ -529 +413,0 @@ status_t FwdLockEngine::onInitializeDecryptUnit(int uniqueId,
->>>>>>> e3c56d16
@@ -532,16 +416,2 @@ status_t FwdLockEngine::onInitializeDecryptUnit(int uniqueId,
-status_t FwdLockEngine::onDecrypt(int uniqueId,
-                                  DecryptHandle* decryptHandle,
-                                  int decryptUnitId,
-                                  const DrmBuffer* encBuffer,
-                                  DrmBuffer** decBuffer) {
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onDecrypt");
-||||||| 1de2393648
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onDecrypt");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onDecrypt");
-=======
-    LOGE("FwdLockEngine::onDecrypt is not supported for this DRM scheme");
->>>>>>> e3c56d16
-=======
+status_t FwdLockEngine::onDecrypt(int uniqueId, DecryptHandle* decryptHandle, int decryptUnitId,
+            const DrmBuffer* encBuffer, DrmBuffer** decBuffer, DrmBuffer* IV) {
@@ -549 +418,0 @@ status_t FwdLockEngine::onDecrypt(int uniqueId,
->>>>>>> e3c56d16
@@ -557,8 +425,0 @@ status_t FwdLockEngine::onDecrypt(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onDecrypt");
-||||||| 1de2393648
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onDecrypt");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onDecrypt");
-=======
@@ -566,4 +426,0 @@ status_t FwdLockEngine::onDecrypt(int uniqueId,
->>>>>>> e3c56d16
-=======
-    LOGE("FwdLockEngine::onDecrypt is not supported for this DRM scheme");
->>>>>>> e3c56d16
@@ -575,5 +431,0 @@ status_t FwdLockEngine::onFinalizeDecryptUnit(int uniqueId,
-<<<<<<< HEAD
-    LOGV("FwdLockEngine::onFinalizeDecryptUnit");
-||||||| 1de2393648
-    LOGD("FwdLockEngine::onFinalizeDecryptUnit");
-=======
@@ -581 +432,0 @@ status_t FwdLockEngine::onFinalizeDecryptUnit(int uniqueId,
->>>>>>> e3c56d16
@@ -604,0 +456,4 @@ ssize_t FwdLockEngine::onRead(int uniqueId,
+#ifdef USE_64BIT_DRM_API
+off64_t FwdLockEngine::onLseek(int uniqueId, DecryptHandle* decryptHandle,
+                               off64_t offset, int whence) {
+#else
@@ -617,0 +473,7 @@ off_t FwdLockEngine::onLseek(int uniqueId, DecryptHandle* decryptHandle,
+#ifdef USE_64BIT_DRM_API
+ssize_t FwdLockEngine::onPread(int uniqueId,
+                               DecryptHandle* decryptHandle,
+                               void* buffer,
+                               ssize_t numBytes,
+                               off64_t offset) {
+#else
