[
  {
    "code": [
      "void restart_tcp_service(int fd, void *cookie)",
      "{",
      "    char buf[100];",
      "    char value[PROPERTY_VALUE_MAX];",
      "    int port = (int)cookie;",
      "",
      "    if (port <= 0) {",
      "        snprintf(buf, sizeof(buf), \"invalid port\\n\");",
      "        writex(fd, buf, strlen(buf));",
      "        adb_close(fd);",
      "        return;",
      "    }",
      "",
      "    snprintf(value, sizeof(value), \"%d\", port);",
      "    property_set(\"service.adb.tcp.port\", value);",
      "    snprintf(buf, sizeof(buf), \"restarting in TCP mode port: %d\\n\", port);",
      "    writex(fd, buf, strlen(buf));",
      "    adb_close(fd);",
      "",
      "    // quit, and init will restart us in TCP mode",
      "    sleep(1);",
      "    exit(1);",
      "}",
      "void restart_usb_service(int fd, void *cookie)",
      "{",
      "    char buf[100];",
      "",
      "    property_set(\"service.adb.tcp.port\", \"0\");",
      "    snprintf(buf, sizeof(buf), \"restarting in USB mode\\n\");",
      "    writex(fd, buf, strlen(buf));",
      "    adb_close(fd);",
      "",
      "    // quit, and init will restart us in USB mode",
      "    sleep(1);",
      "    exit(1);",
      "}",
      "void reboot_service(int fd, void *arg)",
      "{",
      "    char buf[100];",
      "    int ret;",
      "",
      "    sync();",
      "    ret = __reboot(LINUX_REBOOT_MAGIC1, LINUX_REBOOT_MAGIC2,",
      "                    LINUX_REBOOT_CMD_RESTART2, (char *)arg);",
      "    if (ret < 0) {",
      "        snprintf(buf, sizeof(buf), \"reboot failed: %s\\n\", strerror(errno));",
      "        writex(fd, buf, strlen(buf));",
      "    }",
      "    adb_close(fd);",
      "}",
      "void reboot_service(int fd, char *arg)",
      "{",
      "    char buf[100];",
      "    int ret;",
      "",
      "    sync();",
      "    ret = __reboot(LINUX_REBOOT_MAGIC1, LINUX_REBOOT_MAGIC2, LINUX_REBOOT_CMD_RESTART2, arg);",
      "    if (ret < 0) {",
      "        snprintf(buf, sizeof(buf), \"reboot failed: %s\\n\", strerror(errno));",
      "        writex(fd, buf, strlen(buf));",
      "    }",
      "    adb_close(fd);",
      "}"
    ],
    "label": "",
    "index": 0,
    "confidence": 0.4,
    "desc": "List merge."
  }
]