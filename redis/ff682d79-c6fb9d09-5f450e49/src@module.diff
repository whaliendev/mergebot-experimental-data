diff --git a/home/whalien/codebase/cpp/mergebot/eva/output/redis/ff682d79-c6fb9d09-5f450e49/src@module.no_comments_mergebot.c b/home/whalien/codebase/cpp/mergebot/eva/output/redis/ff682d79-c6fb9d09-5f450e49/src@module.no_comments_merged.c
index c09dd7d..efcedff 100644
--- a/home/whalien/codebase/cpp/mergebot/eva/output/redis/ff682d79-c6fb9d09-5f450e49/src@module.no_comments_mergebot.c
+++ b/home/whalien/codebase/cpp/mergebot/eva/output/redis/ff682d79-c6fb9d09-5f450e49/src@module.no_comments_merged.c
@@ -6,2 +5,0 @@
-#define REDISMODULE_CORE 1
-#include "redismodule.h"
@@ -17,2 +15 @@ typedef struct RedisModuleInfoCtx {
-typedef void (*RedisModuleInfoFunc)(RedisModuleInfoCtx *ctx,
-                                    int for_crash_report);
+typedef void (*RedisModuleInfoFunc)(RedisModuleInfoCtx *ctx, int for_crash_report);
@@ -79,7 +76 @@ typedef struct RedisModuleCtx RedisModuleCtx;
-#define REDISMODULE_CTX_INIT \
-  { \
-    (void *)(unsigned long)&RM_GetApi, NULL, NULL, NULL, NULL, 0, 0, 0, NULL, \
-        0, NULL, NULL, NULL, 0, NULL, { \
-      0 \
-    } \
-  }
+#define REDISMODULE_CTX_INIT {(void*)(unsigned long)&RM_GetApi, NULL, NULL, NULL, NULL, 0, 0, 0, NULL, 0, NULL, NULL, NULL, 0, NULL, {0}}
@@ -116,2 +107 @@ typedef int (*RedisModuleCmdFunc)(RedisModuleCtx *ctx, void **argv, int argc);
-typedef void (*RedisModuleDisconnectFunc)(RedisModuleCtx *ctx,
-                                          struct RedisModuleBlockedClient *bc);
+typedef void (*RedisModuleDisconnectFunc) (RedisModuleCtx *ctx, struct RedisModuleBlockedClient *bc);
@@ -126,2 +116 @@ typedef struct RedisModuleCommandProxy RedisModuleCommandProxy;
-#define REDISMODULE_REPLYFLAG_NESTED \
-  (1 << 1)
+#define REDISMODULE_REPLYFLAG_NESTED (1<<1)
@@ -147,2 +136 @@ typedef struct RedisModuleBlockedClient {
-  void (*free_privdata)(RedisModuleCtx *,
-                        void *);
+    void (*free_privdata)(RedisModuleCtx*,void*);
@@ -158,3 +146 @@ static pthread_mutex_t moduleGIL = PTHREAD_MUTEX_INITIALIZER;
-typedef int (*RedisModuleNotificationFunc)(RedisModuleCtx *ctx, int type,
-                                           const char *event,
-                                           RedisModuleString *key);
+typedef int (*RedisModuleNotificationFunc) (RedisModuleCtx *ctx, int type, const char *event, RedisModuleString *key);
@@ -180,2 +166 @@ typedef struct RedisModuleCommandFilterCtx {
-typedef void (*RedisModuleCommandFilterFunc)(
-    RedisModuleCommandFilterCtx *filter);
+typedef void (*RedisModuleCommandFilterFunc) (RedisModuleCommandFilterCtx *filter);
@@ -188,2 +173 @@ static list *moduleCommandFilters;
-typedef void (*RedisModuleForkDoneHandler)(int exitcode, int bysignal,
-                                           void *user_data);
+typedef void (*RedisModuleForkDoneHandler) (int exitcode, int bysignal, void *user_data);
@@ -199,0 +184,2 @@ typedef struct RedisModuleServerInfoData {
+#define SHOULD_SIGNAL_MODIFIED_KEYS(ctx) \
+    ctx->module? !(ctx->module->options & REDISMODULE_OPTION_NO_IMPLICIT_SIGNAL_MODIFIED) : 1
@@ -210,2 +196 @@ void autoMemoryCollect(RedisModuleCtx *ctx);
-robj **moduleCreateArgvFromUserFormat(const char *cmdname, const char *fmt,
-                                      int *argcp, int *flags, va_list ap);
+robj **moduleCreateArgvFromUserFormat(const char *cmdname, const char *fmt, int *argcp, int *flags, va_list ap);
@@ -217,5 +202,15 @@ void RM_FreeServerInfo(RedisModuleCtx *ctx, RedisModuleServerInfoData *data);
-void *RM_Alloc(size_t bytes) { return zmalloc(bytes); }
-void *RM_Calloc(size_t nmemb, size_t size) { return zcalloc(nmemb * size); }
-void *RM_Realloc(void *ptr, size_t bytes) { return zrealloc(ptr, bytes); }
-void RM_Free(void *ptr) { zfree(ptr); }
-char *RM_Strdup(const char *str) { return zstrdup(str); }
+void *RM_Alloc(size_t bytes) {
+    return zmalloc(bytes);
+}
+void *RM_Calloc(size_t nmemb, size_t size) {
+    return zcalloc(nmemb*size);
+}
+void* RM_Realloc(void *ptr, size_t bytes) {
+    return zrealloc(ptr,bytes);
+}
+void RM_Free(void *ptr) {
+    zfree(ptr);
+}
+char *RM_Strdup(const char *str) {
+    return zstrdup(str);
+}
@@ -238 +233,2 @@ void *RM_PoolAlloc(RedisModuleCtx *ctx, size_t bytes) {
-    if (b->used % alignment) b->used += alignment - (b->used % alignment);
+        if (b->used % alignment)
+            b->used += alignment - (b->used % alignment);
@@ -256 +252,2 @@ int moduleCreateEmptyKey(RedisModuleKey *key, int type) {
-  if (!(key->mode & REDISMODULE_WRITE) || key->value) return REDISMODULE_ERR;
+    if (!(key->mode & REDISMODULE_WRITE) || key->value)
+        return REDISMODULE_ERR;
@@ -269,2 +266 @@ int moduleCreateEmptyKey(RedisModuleKey *key, int type) {
-    default:
-      return REDISMODULE_ERR;
+    default: return REDISMODULE_ERR;
@@ -281,17 +277,6 @@ int moduleDelKeyIfEmpty(RedisModuleKey *key) {
-    case OBJ_LIST:
-      isempty = listTypeLength(o) == 0;
-      break;
-    case OBJ_SET:
-      isempty = setTypeSize(o) == 0;
-      break;
-    case OBJ_ZSET:
-      isempty = zsetLength(o) == 0;
-      break;
-    case OBJ_HASH:
-      isempty = hashTypeLength(o) == 0;
-      break;
-    case OBJ_STREAM:
-      isempty = streamLength(o) == 0;
-      break;
-    default:
-      isempty = 0;
+    case OBJ_LIST: isempty = listTypeLength(o) == 0; break;
+    case OBJ_SET: isempty = setTypeSize(o) == 0; break;
+    case OBJ_ZSET: isempty = zsetLength(o) == 0; break;
+    case OBJ_HASH: isempty = hashTypeLength(o) == 0; break;
+    case OBJ_STREAM: isempty = streamLength(o) == 0; break;
+    default: isempty = 0;
@@ -323 +308,2 @@ void moduleHandlePropagationAfterCommandCallback(RedisModuleCtx *ctx) {
-      server.also_propagate.numops) {
+        server.also_propagate.numops)
+    {
@@ -327 +313,2 @@ void moduleHandlePropagationAfterCommandCallback(RedisModuleCtx *ctx) {
-      if (target) propagate(rop->cmd, rop->dbid, rop->argv, rop->argc, target);
+            if (target)
+                propagate(rop->cmd,rop->dbid,rop->argv,rop->argc,target);
@@ -340,2 +327 @@ void moduleFreeContext(RedisModuleCtx *ctx) {
-    serverLog(
-        LL_WARNING,
+        serverLog(LL_WARNING,
@@ -359 +345,2 @@ void RedisModuleCommandDispatcher(client *c) {
-    if (c->argv[i]->refcount > 1) trimStringObjectIfNeeded(c->argv[i]);
+        if (c->argv[i]->refcount > 1)
+            trimStringObjectIfNeeded(c->argv[i]);
@@ -362,2 +349 @@ void RedisModuleCommandDispatcher(client *c) {
-int *moduleGetCommandKeysViaAPI(struct redisCommand *cmd, robj **argv, int argc,
-                                int *numkeys) {
+int *moduleGetCommandKeysViaAPI(struct redisCommand *cmd, robj **argv, int argc, int *numkeys) {
@@ -390,28 +376,14 @@ int commandFlagsFromString(char *s) {
-    if (!strcasecmp(t, "write"))
-      flags |= CMD_WRITE;
-    else if (!strcasecmp(t, "readonly"))
-      flags |= CMD_READONLY;
-    else if (!strcasecmp(t, "admin"))
-      flags |= CMD_ADMIN;
-    else if (!strcasecmp(t, "deny-oom"))
-      flags |= CMD_DENYOOM;
-    else if (!strcasecmp(t, "deny-script"))
-      flags |= CMD_NOSCRIPT;
-    else if (!strcasecmp(t, "allow-loading"))
-      flags |= CMD_LOADING;
-    else if (!strcasecmp(t, "pubsub"))
-      flags |= CMD_PUBSUB;
-    else if (!strcasecmp(t, "random"))
-      flags |= CMD_RANDOM;
-    else if (!strcasecmp(t, "allow-stale"))
-      flags |= CMD_STALE;
-    else if (!strcasecmp(t, "no-monitor"))
-      flags |= CMD_SKIP_MONITOR;
-    else if (!strcasecmp(t, "fast"))
-      flags |= CMD_FAST;
-    else if (!strcasecmp(t, "getkeys-api"))
-      flags |= CMD_MODULE_GETKEYS;
-    else if (!strcasecmp(t, "no-cluster"))
-      flags |= CMD_MODULE_NO_CLUSTER;
-    else
-      break;
+        if (!strcasecmp(t,"write")) flags |= CMD_WRITE;
+        else if (!strcasecmp(t,"readonly")) flags |= CMD_READONLY;
+        else if (!strcasecmp(t,"admin")) flags |= CMD_ADMIN;
+        else if (!strcasecmp(t,"deny-oom")) flags |= CMD_DENYOOM;
+        else if (!strcasecmp(t,"deny-script")) flags |= CMD_NOSCRIPT;
+        else if (!strcasecmp(t,"allow-loading")) flags |= CMD_LOADING;
+        else if (!strcasecmp(t,"pubsub")) flags |= CMD_PUBSUB;
+        else if (!strcasecmp(t,"random")) flags |= CMD_RANDOM;
+        else if (!strcasecmp(t,"allow-stale")) flags |= CMD_STALE;
+        else if (!strcasecmp(t,"no-monitor")) flags |= CMD_SKIP_MONITOR;
+        else if (!strcasecmp(t,"fast")) flags |= CMD_FAST;
+        else if (!strcasecmp(t,"getkeys-api")) flags |= CMD_MODULE_GETKEYS;
+        else if (!strcasecmp(t,"no-cluster")) flags |= CMD_MODULE_NO_CLUSTER;
+        else break;
@@ -423,3 +395 @@ int commandFlagsFromString(char *s) {
-int RM_CreateCommand(RedisModuleCtx *ctx, const char *name,
-                     RedisModuleCmdFunc cmdfunc, const char *strflags,
-                     int firstkey, int lastkey, int keystep) {
+int RM_CreateCommand(RedisModuleCtx *ctx, const char *name, RedisModuleCmdFunc cmdfunc, const char *strflags, int firstkey, int lastkey, int keystep) {
@@ -456,2 +426 @@ int RM_CreateCommand(RedisModuleCtx *ctx, const char *name,
-void RM_SetModuleAttribs(RedisModuleCtx *ctx, const char *name, int ver,
-                         int apiver) {
+void RM_SetModuleAttribs(RedisModuleCtx *ctx, const char *name, int ver, int apiver) {
@@ -479 +448,3 @@ int RM_IsModuleNameBusy(const char *name) {
-long long RM_Milliseconds(void) { return mstime(); }
+long long RM_Milliseconds(void) {
+    return mstime();
+}
@@ -495,2 +466 @@ void autoMemoryAdd(RedisModuleCtx *ctx, int type, void *ptr) {
-    ctx->amqueue =
-        zrealloc(ctx->amqueue, sizeof(struct AutoMemEntry) * ctx->amqueue_len);
+        ctx->amqueue = zrealloc(ctx->amqueue,sizeof(struct AutoMemEntry)*ctx->amqueue_len);
@@ -508 +478,3 @@ int autoMemoryFreed(RedisModuleCtx *ctx, int type, void *ptr) {
-      if (ctx->amqueue[i].type == type && ctx->amqueue[i].ptr == ptr) {
+            if (ctx->amqueue[i].type == type &&
+                ctx->amqueue[i].ptr == ptr)
+            {
@@ -527,15 +499,5 @@ void autoMemoryCollect(RedisModuleCtx *ctx) {
-      case REDISMODULE_AM_STRING:
-        decrRefCount(ptr);
-        break;
-      case REDISMODULE_AM_REPLY:
-        RM_FreeCallReply(ptr);
-        break;
-      case REDISMODULE_AM_KEY:
-        RM_CloseKey(ptr);
-        break;
-      case REDISMODULE_AM_DICT:
-        RM_FreeDict(NULL, ptr);
-        break;
-      case REDISMODULE_AM_INFO:
-        RM_FreeServerInfo(NULL, ptr);
-        break;
+        case REDISMODULE_AM_STRING: decrRefCount(ptr); break;
+        case REDISMODULE_AM_REPLY: RM_FreeCallReply(ptr); break;
+        case REDISMODULE_AM_KEY: RM_CloseKey(ptr); break;
+        case REDISMODULE_AM_DICT: RM_FreeDict(NULL,ptr); break;
+        case REDISMODULE_AM_INFO: RM_FreeServerInfo(NULL,ptr); break;
@@ -550,2 +512 @@ void autoMemoryCollect(RedisModuleCtx *ctx) {
-RedisModuleString *RM_CreateString(RedisModuleCtx *ctx, const char *ptr,
-                                   size_t len) {
+RedisModuleString *RM_CreateString(RedisModuleCtx *ctx, const char *ptr, size_t len) {
@@ -556,2 +517 @@ RedisModuleString *RM_CreateString(RedisModuleCtx *ctx, const char *ptr,
-RedisModuleString *RM_CreateStringPrintf(RedisModuleCtx *ctx, const char *fmt,
-                                         ...) {
+RedisModuleString *RM_CreateStringPrintf(RedisModuleCtx *ctx, const char *fmt, ...) {
@@ -567,2 +527 @@ RedisModuleString *RM_CreateStringPrintf(RedisModuleCtx *ctx, const char *fmt,
-RedisModuleString *RM_CreateStringFromLongLong(RedisModuleCtx *ctx,
-                                               long long ll) {
+RedisModuleString *RM_CreateStringFromLongLong(RedisModuleCtx *ctx, long long ll) {
@@ -573,3 +532 @@ RedisModuleString *RM_CreateStringFromLongLong(RedisModuleCtx *ctx,
-RedisModuleString *RM_CreateStringFromLongDouble(RedisModuleCtx *ctx,
-                                                 long double ld,
-                                                 int humanfriendly) {
+RedisModuleString *RM_CreateStringFromLongDouble(RedisModuleCtx *ctx, long double ld, int humanfriendly) {
@@ -581,2 +538 @@ RedisModuleString *RM_CreateStringFromLongDouble(RedisModuleCtx *ctx,
-RedisModuleString *RM_CreateStringFromString(RedisModuleCtx *ctx,
-                                             const RedisModuleString *str) {
+RedisModuleString *RM_CreateStringFromString(RedisModuleCtx *ctx, const RedisModuleString *str) {
@@ -606,2 +562,2 @@ int RM_StringToLongLong(const RedisModuleString *str, long long *ll) {
-  return string2ll(str->ptr, sdslen(str->ptr), ll) ? REDISMODULE_OK
-                                                   : REDISMODULE_ERR;
+    return string2ll(str->ptr,sdslen(str->ptr),ll) ? REDISMODULE_OK :
+                                                     REDISMODULE_ERR;
@@ -637,2 +593 @@ RedisModuleString *moduleAssertUnsharedString(RedisModuleString *str) {
-int RM_StringAppendBuffer(RedisModuleCtx *ctx, RedisModuleString *str,
-                          const char *buf, size_t len) {
+int RM_StringAppendBuffer(RedisModuleCtx *ctx, RedisModuleString *str, const char *buf, size_t len) {
@@ -646 +601,2 @@ int RM_WrongArity(RedisModuleCtx *ctx) {
-  addReplyErrorFormat(ctx->client, "wrong number of arguments for '%s' command",
+    addReplyErrorFormat(ctx->client,
+        "wrong number of arguments for '%s' command",
@@ -684,4 +640,4 @@ int RM_ReplyWithArray(RedisModuleCtx *ctx, long len) {
-    ctx->postponed_arrays =
-        zrealloc(ctx->postponed_arrays,
-                 sizeof(void *) * (ctx->postponed_arrays_count + 1));
-    ctx->postponed_arrays[ctx->postponed_arrays_count] = addReplyDeferredLen(c);
+        ctx->postponed_arrays = zrealloc(ctx->postponed_arrays,sizeof(void*)*
+                (ctx->postponed_arrays_count+1));
+        ctx->postponed_arrays[ctx->postponed_arrays_count] =
+            addReplyDeferredLen(c);
@@ -714,2 +670 @@ void RM_ReplySetArrayLength(RedisModuleCtx *ctx, long len) {
-              "call.",
-              ctx->module->name);
+            "call.", ctx->module->name);
@@ -719 +674,2 @@ void RM_ReplySetArrayLength(RedisModuleCtx *ctx, long len) {
-  setDeferredArrayLen(c, ctx->postponed_arrays[ctx->postponed_arrays_count],
+    setDeferredArrayLen(c,
+            ctx->postponed_arrays[ctx->postponed_arrays_count],
@@ -750,2 +706 @@ int RM_ReplyWithEmptyString(RedisModuleCtx *ctx) {
-int RM_ReplyWithVerbatimString(RedisModuleCtx *ctx, const char *buf,
-                               size_t len) {
+int RM_ReplyWithVerbatimString(RedisModuleCtx *ctx, const char *buf, size_t len) {
@@ -793,2 +748 @@ void moduleReplicateMultiIfNeeded(RedisModuleCtx *ctx) {
-int RM_Replicate(RedisModuleCtx *ctx, const char *cmdname, const char *fmt,
-                 ...) {
+int RM_Replicate(RedisModuleCtx *ctx, const char *cmdname, const char *fmt, ...) {
@@ -820,2 +774,3 @@ int RM_ReplicateVerbatim(RedisModuleCtx *ctx) {
-  alsoPropagate(ctx->client->cmd, ctx->client->db->id, ctx->client->argv,
-                ctx->client->argc, PROPAGATE_AOF | PROPAGATE_REPL);
+    alsoPropagate(ctx->client->cmd,ctx->client->db->id,
+        ctx->client->argv,ctx->client->argc,
+        PROPAGATE_AOF|PROPAGATE_REPL);
@@ -872,2 +827 @@ int RM_GetClientInfoById(void *ci, uint64_t id) {
-int RM_PublishMessage(RedisModuleCtx *ctx, RedisModuleString *channel,
-                      RedisModuleString *message) {
+int RM_PublishMessage(RedisModuleCtx *ctx, RedisModuleString *channel, RedisModuleString *message) {
@@ -876 +830,2 @@ int RM_PublishMessage(RedisModuleCtx *ctx, RedisModuleString *channel,
-  if (server.cluster_enabled) clusterPropagatePublish(channel, message);
+    if (server.cluster_enabled)
+        clusterPropagatePublish(channel, message);
@@ -879 +834,3 @@ int RM_PublishMessage(RedisModuleCtx *ctx, RedisModuleString *channel,
-int RM_GetSelectedDb(RedisModuleCtx *ctx) { return ctx->client->db->id; }
+int RM_GetSelectedDb(RedisModuleCtx *ctx) {
+    return ctx->client->db->id;
+}
@@ -883,2 +840,4 @@ int RM_GetContextFlags(RedisModuleCtx *ctx) {
-    if (ctx->client->flags & CLIENT_LUA) flags |= REDISMODULE_CTX_FLAGS_LUA;
-    if (ctx->client->flags & CLIENT_MULTI) flags |= REDISMODULE_CTX_FLAGS_MULTI;
+        if (ctx->client->flags & CLIENT_LUA)
+         flags |= REDISMODULE_CTX_FLAGS_LUA;
+        if (ctx->client->flags & CLIENT_MULTI)
+         flags |= REDISMODULE_CTX_FLAGS_MULTI;
@@ -888,2 +847,4 @@ int RM_GetContextFlags(RedisModuleCtx *ctx) {
-  if (server.cluster_enabled) flags |= REDISMODULE_CTX_FLAGS_CLUSTER;
-  if (server.loading) flags |= REDISMODULE_CTX_FLAGS_LOADING;
+    if (server.cluster_enabled)
+        flags |= REDISMODULE_CTX_FLAGS_CLUSTER;
+    if (server.loading)
+        flags |= REDISMODULE_CTX_FLAGS_LOADING;
@@ -895,2 +856,4 @@ int RM_GetContextFlags(RedisModuleCtx *ctx) {
-  if (server.aof_state != AOF_OFF) flags |= REDISMODULE_CTX_FLAGS_AOF;
-  if (server.saveparamslen > 0) flags |= REDISMODULE_CTX_FLAGS_RDB;
+    if (server.aof_state != AOF_OFF)
+        flags |= REDISMODULE_CTX_FLAGS_AOF;
+    if (server.saveparamslen > 0)
+        flags |= REDISMODULE_CTX_FLAGS_RDB;
@@ -901 +864,2 @@ int RM_GetContextFlags(RedisModuleCtx *ctx) {
-    if (server.repl_slave_ro) flags |= REDISMODULE_CTX_FLAGS_READONLY;
+        if (server.repl_slave_ro)
+            flags |= REDISMODULE_CTX_FLAGS_READONLY;
@@ -903 +867,2 @@ int RM_GetContextFlags(RedisModuleCtx *ctx) {
-        server.repl_state == REPL_STATE_CONNECTING) {
+            server.repl_state == REPL_STATE_CONNECTING)
+        {
@@ -924,2 +889 @@ int RM_SelectDb(RedisModuleCtx *ctx, int newid) {
-static void moduleInitKey(RedisModuleKey *kp, RedisModuleCtx *ctx,
-                          robj *keyname, robj *value, int mode) {
+static void moduleInitKey(RedisModuleKey *kp, RedisModuleCtx *ctx, robj *keyname, robj *value, int mode){
@@ -968,16 +932,8 @@ int RM_KeyType(RedisModuleKey *key) {
-    case OBJ_STRING:
-      return REDISMODULE_KEYTYPE_STRING;
-    case OBJ_LIST:
-      return REDISMODULE_KEYTYPE_LIST;
-    case OBJ_SET:
-      return REDISMODULE_KEYTYPE_SET;
-    case OBJ_ZSET:
-      return REDISMODULE_KEYTYPE_ZSET;
-    case OBJ_HASH:
-      return REDISMODULE_KEYTYPE_HASH;
-    case OBJ_MODULE:
-      return REDISMODULE_KEYTYPE_MODULE;
-    case OBJ_STREAM:
-      return REDISMODULE_KEYTYPE_STREAM;
-    default:
-      return 0;
+    case OBJ_STRING: return REDISMODULE_KEYTYPE_STRING;
+    case OBJ_LIST: return REDISMODULE_KEYTYPE_LIST;
+    case OBJ_SET: return REDISMODULE_KEYTYPE_SET;
+    case OBJ_ZSET: return REDISMODULE_KEYTYPE_ZSET;
+    case OBJ_HASH: return REDISMODULE_KEYTYPE_HASH;
+    case OBJ_MODULE: return REDISMODULE_KEYTYPE_MODULE;
+    case OBJ_STREAM: return REDISMODULE_KEYTYPE_STREAM;
+    default: return 0;
@@ -989,14 +945,7 @@ size_t RM_ValueLength(RedisModuleKey *key) {
-    case OBJ_STRING:
-      return stringObjectLen(key->value);
-    case OBJ_LIST:
-      return listTypeLength(key->value);
-    case OBJ_SET:
-      return setTypeSize(key->value);
-    case OBJ_ZSET:
-      return zsetLength(key->value);
-    case OBJ_HASH:
-      return hashTypeLength(key->value);
-    case OBJ_STREAM:
-      return streamLength(key->value);
-    default:
-      return 0;
+    case OBJ_STRING: return stringObjectLen(key->value);
+    case OBJ_LIST: return listTypeLength(key->value);
+    case OBJ_SET: return setTypeSize(key->value);
+    case OBJ_ZSET: return zsetLength(key->value);
+    case OBJ_HASH: return hashTypeLength(key->value);
+    case OBJ_STREAM: return streamLength(key->value);
+    default: return 0;
@@ -1097,2 +1046 @@ int RM_ListPush(RedisModuleKey *key, int where, RedisModuleString *ele) {
-  listTypePush(
-      key->value, ele,
+    listTypePush(key->value, ele,
@@ -1103,6 +1051,5 @@ RedisModuleString *RM_ListPop(RedisModuleKey *key, int where) {
-  if (!(key->mode & REDISMODULE_WRITE) || key->value == NULL ||
-      key->value->type != OBJ_LIST)
-    return NULL;
-  robj *ele = listTypePop(key->value, (where == REDISMODULE_LIST_HEAD)
-                                          ? QUICKLIST_HEAD
-                                          : QUICKLIST_TAIL);
+    if (!(key->mode & REDISMODULE_WRITE) ||
+        key->value == NULL ||
+        key->value->type != OBJ_LIST) return NULL;
+    robj *ele = listTypePop(key->value,
+        (where == REDISMODULE_LIST_HEAD) ? QUICKLIST_HEAD : QUICKLIST_TAIL);
@@ -1128,2 +1075 @@ int RM_ZsetAddFlagsFromCoreFlags(int flags) {
-int RM_ZsetAdd(RedisModuleKey *key, double score, RedisModuleString *ele,
-               int *flagsptr) {
+int RM_ZsetAdd(RedisModuleKey *key, double score, RedisModuleString *ele, int *flagsptr) {
@@ -1142,2 +1088 @@ int RM_ZsetAdd(RedisModuleKey *key, double score, RedisModuleString *ele,
-int RM_ZsetIncrby(RedisModuleKey *key, double score, RedisModuleString *ele,
-                  int *flagsptr, double *newscore) {
+int RM_ZsetIncrby(RedisModuleKey *key, double score, RedisModuleString *ele, int *flagsptr, double *newscore) {
@@ -1183 +1128,2 @@ void RM_ZsetRangeStop(RedisModuleKey *key) {
-  if (key->ztype == REDISMODULE_ZSET_RANGE_LEX) zslFreeLexRange(&key->zlrs);
+    if (key->ztype == REDISMODULE_ZSET_RANGE_LEX)
+        zslFreeLexRange(&key->zlrs);
@@ -1186,3 +1132,4 @@ void RM_ZsetRangeStop(RedisModuleKey *key) {
-int RM_ZsetRangeEndReached(RedisModuleKey *key) { return key->zer; }
-int zsetInitScoreRange(RedisModuleKey *key, double min, double max, int minex,
-                       int maxex, int first) {
+int RM_ZsetRangeEndReached(RedisModuleKey *key) {
+    return key->zer;
+}
+int zsetInitScoreRange(RedisModuleKey *key, double min, double max, int minex, int maxex, int first) {
@@ -1199,2 +1146,2 @@ int zsetInitScoreRange(RedisModuleKey *key, double min, double max, int minex,
-    key->zcurrent = first ? zzlFirstInRange(key->value->ptr, zrs)
-                          : zzlLastInRange(key->value->ptr, zrs);
+        key->zcurrent = first ? zzlFirstInRange(key->value->ptr,zrs) :
+                                zzlLastInRange(key->value->ptr,zrs);
@@ -1204,2 +1151,2 @@ int zsetInitScoreRange(RedisModuleKey *key, double min, double max, int minex,
-    key->zcurrent =
-        first ? zslFirstInRange(zsl, zrs) : zslLastInRange(zsl, zrs);
+        key->zcurrent = first ? zslFirstInRange(zsl,zrs) :
+                                zslLastInRange(zsl,zrs);
@@ -1212,2 +1159 @@ int zsetInitScoreRange(RedisModuleKey *key, double min, double max, int minex,
-int RM_ZsetFirstInScoreRange(RedisModuleKey *key, double min, double max,
-                             int minex, int maxex) {
+int RM_ZsetFirstInScoreRange(RedisModuleKey *key, double min, double max, int minex, int maxex) {
@@ -1216,2 +1162 @@ int RM_ZsetFirstInScoreRange(RedisModuleKey *key, double min, double max,
-int RM_ZsetLastInScoreRange(RedisModuleKey *key, double min, double max,
-                            int minex, int maxex) {
+int RM_ZsetLastInScoreRange(RedisModuleKey *key, double min, double max, int minex, int maxex) {
@@ -1220,2 +1165 @@ int RM_ZsetLastInScoreRange(RedisModuleKey *key, double min, double max,
-int zsetInitLexRange(RedisModuleKey *key, RedisModuleString *min,
-                     RedisModuleString *max, int first) {
+int zsetInitLexRange(RedisModuleKey *key, RedisModuleString *min, RedisModuleString *max, int first) {
@@ -1229,2 +1173,2 @@ int zsetInitLexRange(RedisModuleKey *key, RedisModuleString *min,
-    key->zcurrent = first ? zzlFirstInLexRange(key->value->ptr, zlrs)
-                          : zzlLastInLexRange(key->value->ptr, zlrs);
+        key->zcurrent = first ? zzlFirstInLexRange(key->value->ptr,zlrs) :
+                                zzlLastInLexRange(key->value->ptr,zlrs);
@@ -1234,2 +1178,2 @@ int zsetInitLexRange(RedisModuleKey *key, RedisModuleString *min,
-    key->zcurrent =
-        first ? zslFirstInLexRange(zsl, zlrs) : zslLastInLexRange(zsl, zlrs);
+        key->zcurrent = first ? zslFirstInLexRange(zsl,zlrs) :
+                                zslLastInLexRange(zsl,zlrs);
@@ -1242,2 +1186 @@ int zsetInitLexRange(RedisModuleKey *key, RedisModuleString *min,
-int RM_ZsetFirstInLexRange(RedisModuleKey *key, RedisModuleString *min,
-                           RedisModuleString *max) {
+int RM_ZsetFirstInLexRange(RedisModuleKey *key, RedisModuleString *min, RedisModuleString *max) {
@@ -1246,2 +1189 @@ int RM_ZsetFirstInLexRange(RedisModuleKey *key, RedisModuleString *min,
-int RM_ZsetLastInLexRange(RedisModuleKey *key, RedisModuleString *min,
-                          RedisModuleString *max) {
+int RM_ZsetLastInLexRange(RedisModuleKey *key, RedisModuleString *min, RedisModuleString *max) {
@@ -1250,2 +1192 @@ int RM_ZsetLastInLexRange(RedisModuleKey *key, RedisModuleString *min,
-RedisModuleString *RM_ZsetRangeCurrentElement(RedisModuleKey *key,
-                                              double *score) {
+RedisModuleString *RM_ZsetRangeCurrentElement(RedisModuleKey *key, double *score) {
@@ -1310 +1251,2 @@ int RM_ZsetRangeNext(RedisModuleKey *key) {
-          !zslValueLteMax(next->score, &key->zrs)) {
+                !zslValueLteMax(next->score,&key->zrs))
+            {
@@ -1363 +1305,2 @@ int RM_ZsetRangePrev(RedisModuleKey *key) {
-          !zslValueGteMin(prev->score, &key->zrs)) {
+                !zslValueGteMin(prev->score,&key->zrs))
+            {
@@ -1400 +1343,2 @@ int RM_HashSet(RedisModuleKey *key, int flags, ...) {
-          ((flags & REDISMODULE_HASH_NX) && exists)) {
+                ((flags & REDISMODULE_HASH_NX) && exists))
+            {
@@ -1411 +1355,2 @@ int RM_HashSet(RedisModuleKey *key, int flags, ...) {
-    if (flags & REDISMODULE_HASH_CFIELDS) low_flags |= HASH_SET_TAKE_FIELD;
+        if (flags & REDISMODULE_HASH_CFIELDS)
+            low_flags |= HASH_SET_TAKE_FIELD;
@@ -1465,2 +1410 @@ int RM_HashGet(RedisModuleKey *key, int flags, ...) {
-RedisModuleCallReply *moduleCreateCallReplyFromProto(RedisModuleCtx *ctx,
-                                                     sds proto) {
+RedisModuleCallReply *moduleCreateCallReplyFromProto(RedisModuleCtx *ctx, sds proto) {
@@ -1474,15 +1418,5 @@ RedisModuleCallReply *moduleCreateCallReplyFromProto(RedisModuleCtx *ctx,
-    case '+':
-      reply->type = REDISMODULE_REPLY_STRING;
-      break;
-    case '-':
-      reply->type = REDISMODULE_REPLY_ERROR;
-      break;
-    case ':':
-      reply->type = REDISMODULE_REPLY_INTEGER;
-      break;
-    case '*':
-      reply->type = REDISMODULE_REPLY_ARRAY;
-      break;
-    default:
-      reply->type = REDISMODULE_REPLY_UNKNOWN;
-      break;
+    case '+': reply->type = REDISMODULE_REPLY_STRING; break;
+    case '-': reply->type = REDISMODULE_REPLY_ERROR; break;
+    case ':': reply->type = REDISMODULE_REPLY_INTEGER; break;
+    case '*': reply->type = REDISMODULE_REPLY_ARRAY; break;
+    default: reply->type = REDISMODULE_REPLY_UNKNOWN; break;
@@ -1502,6 +1436,2 @@ void moduleParseCallReply(RedisModuleCallReply *reply) {
-    case ':':
-      moduleParseCallReply_Int(reply);
-      break;
-    case '$':
-      moduleParseCallReply_BulkString(reply);
-      break;
+    case ':': moduleParseCallReply_Int(reply); break;
+    case '$': moduleParseCallReply_BulkString(reply); break;
@@ -1509,6 +1439,2 @@ void moduleParseCallReply(RedisModuleCallReply *reply) {
-    case '+':
-      moduleParseCallReply_SimpleString(reply);
-      break;
-    case '*':
-      moduleParseCallReply_Array(reply);
-      break;
+    case '+': moduleParseCallReply_SimpleString(reply); break;
+    case '*': moduleParseCallReply_Array(reply); break;
@@ -1545,2 +1471,2 @@ void moduleParseCallReply_SimpleString(RedisModuleCallReply *reply) {
-  reply->type =
-      proto[0] == '+' ? REDISMODULE_REPLY_STRING : REDISMODULE_REPLY_ERROR;
+    reply->type = proto[0] == '+' ? REDISMODULE_REPLY_STRING :
+                                    REDISMODULE_REPLY_ERROR;
@@ -1563 +1489,2 @@ void moduleParseCallReply_Array(RedisModuleCallReply *reply) {
-    ele->flags = REDISMODULE_REPLYFLAG_NESTED | REDISMODULE_REPLYFLAG_TOPARSE;
+        ele->flags = REDISMODULE_REPLYFLAG_NESTED |
+                     REDISMODULE_REPLYFLAG_TOPARSE;
@@ -1607,2 +1534 @@ size_t RM_CallReplyLength(RedisModuleCallReply *reply) {
-RedisModuleCallReply *RM_CallReplyArrayElement(RedisModuleCallReply *reply,
-                                               size_t idx) {
+RedisModuleCallReply *RM_CallReplyArrayElement(RedisModuleCallReply *reply, size_t idx) {
@@ -1622,2 +1548 @@ const char *RM_CallReplyStringPtr(RedisModuleCallReply *reply, size_t *len) {
-      reply->type != REDISMODULE_REPLY_ERROR)
-    return NULL;
+        reply->type != REDISMODULE_REPLY_ERROR) return NULL;
@@ -1638,2 +1563 @@ RedisModuleString *RM_CreateStringFromCallReply(RedisModuleCallReply *reply) {
-    default:
-      return NULL;
+    default: return NULL;
@@ -1642,2 +1566 @@ RedisModuleString *RM_CreateStringFromCallReply(RedisModuleCallReply *reply) {
-robj **moduleCreateArgvFromUserFormat(const char *cmdname, const char *fmt,
-                                      int *argcp, int *flags, va_list ap) {
+robj **moduleCreateArgvFromUserFormat(const char *cmdname, const char *fmt, int *argcp, int *flags, va_list ap) {
@@ -1690 +1613,2 @@ fmterr:
-  for (j = 0; j < argc; j++) decrRefCount(argv[j]);
+    for (j = 0; j < argc; j++)
+        decrRefCount(argv[j]);
@@ -1694,2 +1618 @@ fmterr:
-RedisModuleCallReply *RM_Call(RedisModuleCtx *ctx, const char *cmdname,
-                              const char *fmt, ...) {
+RedisModuleCallReply *RM_Call(RedisModuleCtx *ctx, const char *cmdname, const char *fmt, ...) {
@@ -1733 +1656,2 @@ RedisModuleCallReply *RM_Call(RedisModuleCtx *ctx, const char *cmdname,
-        server.cluster->myself) {
+                           server.cluster->myself)
+        {
@@ -1844,2 +1768 @@ void moduleTypeNameByID(char *name, uint64_t moduleid) {
-moduleType *RM_CreateDataType(RedisModuleCtx *ctx, const char *name, int encver,
-                              void *typemethods_ptr) {
+moduleType *RM_CreateDataType(RedisModuleCtx *ctx, const char *name, int encver, void *typemethods_ptr) {
@@ -1893,3 +1816,3 @@ moduleType *RM_ModuleTypeGetType(RedisModuleKey *key) {
-  if (key == NULL || key->value == NULL ||
-      RM_KeyType(key) != REDISMODULE_KEYTYPE_MODULE)
-    return NULL;
+    if (key == NULL ||
+        key->value == NULL ||
+        RM_KeyType(key) != REDISMODULE_KEYTYPE_MODULE) return NULL;
@@ -1900,3 +1823,3 @@ void *RM_ModuleTypeGetValue(RedisModuleKey *key) {
-  if (key == NULL || key->value == NULL ||
-      RM_KeyType(key) != REDISMODULE_KEYTYPE_MODULE)
-    return NULL;
+    if (key == NULL ||
+        key->value == NULL ||
+        RM_KeyType(key) != REDISMODULE_KEYTYPE_MODULE) return NULL;
@@ -1915 +1838,2 @@ void moduleRDBLoadError(RedisModuleIO *io) {
-            io->type->module->name, io->type->name,
+        io->type->module->name,
+        io->type->name,
@@ -1925 +1849,2 @@ int moduleAllDatatypesHandleErrors() {
-        !(module->options & REDISMODULE_OPTIONS_HANDLE_IO_ERRORS)) {
+            !(module->options & REDISMODULE_OPTIONS_HANDLE_IO_ERRORS))
+        {
@@ -1933 +1858,3 @@ int moduleAllDatatypesHandleErrors() {
-int RM_IsIOError(RedisModuleIO *io) { return io->error; }
+int RM_IsIOError(RedisModuleIO *io) {
+    return io->error;
+}
@@ -1961,4 +1888 @@ void RM_SaveSigned(RedisModuleIO *io, int64_t value) {
-  union {
-    uint64_t u;
-    int64_t i;
-  } conv;
+    union {uint64_t u; int64_t i;} conv;
@@ -1969,4 +1893 @@ int64_t RM_LoadSigned(RedisModuleIO *io) {
-  union {
-    uint64_t u;
-    int64_t i;
-  } conv;
+    union {uint64_t u; int64_t i;} conv;
@@ -2006,2 +1927,2 @@ void *moduleLoadString(RedisModuleIO *io, int plain, size_t *lenptr) {
-  void *s = rdbGenericLoadStringObject(
-      io->rio, plain ? RDB_LOAD_PLAIN : RDB_LOAD_NONE, lenptr);
+    void *s = rdbGenericLoadStringObject(io->rio,
+              plain ? RDB_LOAD_PLAIN : RDB_LOAD_NONE, lenptr);
@@ -2099 +2020,2 @@ ssize_t rdbSaveModulesAux(rio *rdb, int when) {
-      if (!mt->aux_save || !(mt->aux_save_triggers & when)) continue;
+            if (!mt->aux_save || !(mt->aux_save_triggers & when))
+                continue;
@@ -2111,2 +2033 @@ ssize_t rdbSaveModulesAux(rio *rdb, int when) {
-void RM_DigestAddStringBuffer(RedisModuleDigest *md, unsigned char *ele,
-                              size_t len) {
+void RM_DigestAddStringBuffer(RedisModuleDigest *md, unsigned char *ele, size_t len) {
@@ -2124,2 +2045 @@ void RM_DigestEndSequence(RedisModuleDigest *md) {
-void *RM_LoadDataTypeFromString(const RedisModuleString *str,
-                                const moduleType *mt) {
+void *RM_LoadDataTypeFromString(const RedisModuleString *str, const moduleType *mt) {
@@ -2139,2 +2059 @@ void *RM_LoadDataTypeFromString(const RedisModuleString *str,
-RedisModuleString *RM_SaveDataTypeToString(RedisModuleCtx *ctx, void *data,
-                                           const moduleType *mt) {
+RedisModuleString *RM_SaveDataTypeToString(RedisModuleCtx *ctx, void *data, const moduleType *mt) {
@@ -2186 +2105,2 @@ void RM_EmitAOF(RedisModuleIO *io, const char *cmdname, const char *fmt, ...) {
-  if (!io->error && rioWriteBulkCount(io->rio, '*', argc) == 0) io->error = 1;
+    if (!io->error && rioWriteBulkCount(io->rio,'*',argc) == 0)
+        io->error = 1;
@@ -2188 +2108,2 @@ void RM_EmitAOF(RedisModuleIO *io, const char *cmdname, const char *fmt, ...) {
-    if (!io->error && rioWriteBulkObject(io->rio, argv[j]) == 0) io->error = 1;
+        if (!io->error && rioWriteBulkObject(io->rio,argv[j]) == 0)
+            io->error = 1;
@@ -2209,2 +2130 @@ const RedisModuleString *RM_GetKeyNameFromModuleKey(RedisModuleKey *key) {
-void RM_LogRaw(RedisModule *module, const char *levelstr, const char *fmt,
-               va_list ap) {
+void RM_LogRaw(RedisModule *module, const char *levelstr, const char *fmt, va_list ap) {
@@ -2214,10 +2134,5 @@ void RM_LogRaw(RedisModule *module, const char *levelstr, const char *fmt,
-  if (!strcasecmp(levelstr, "debug"))
-    level = LL_DEBUG;
-  else if (!strcasecmp(levelstr, "verbose"))
-    level = LL_VERBOSE;
-  else if (!strcasecmp(levelstr, "notice"))
-    level = LL_NOTICE;
-  else if (!strcasecmp(levelstr, "warning"))
-    level = LL_WARNING;
-  else
-    level = LL_VERBOSE;
+    if (!strcasecmp(levelstr,"debug")) level = LL_DEBUG;
+    else if (!strcasecmp(levelstr,"verbose")) level = LL_VERBOSE;
+    else if (!strcasecmp(levelstr,"notice")) level = LL_NOTICE;
+    else if (!strcasecmp(levelstr,"warning")) level = LL_WARNING;
+    else level = LL_VERBOSE;
@@ -2225,2 +2140 @@ void RM_LogRaw(RedisModule *module, const char *levelstr, const char *fmt,
-  name_len =
-      snprintf(msg, sizeof(msg), "<%s> ", module ? module->name : "module");
+    name_len = snprintf(msg, sizeof(msg),"<%s> ", module? module->name: "module");
@@ -2236,2 +2150 @@ void RM_Log(RedisModuleCtx *ctx, const char *levelstr, const char *fmt, ...) {
-void RM_LogIOError(RedisModuleIO *io, const char *levelstr, const char *fmt,
-                   ...) {
+void RM_LogIOError(RedisModuleIO *io, const char *levelstr, const char *fmt, ...) {
@@ -2250,2 +2163 @@ void RM_LatencyAddSample(const char *event, mstime_t latency) {
-void moduleBlockedClientPipeReadable(aeEventLoop *el, int fd, void *privdata,
-                                     int mask) {
+void moduleBlockedClientPipeReadable(aeEventLoop *el, int fd, void *privdata, int mask) {
@@ -2270,5 +2182 @@ void unblockClientFromModule(client *c) {
-RedisModuleBlockedClient *moduleBlockClient(
-    RedisModuleCtx *ctx, RedisModuleCmdFunc reply_callback,
-    RedisModuleCmdFunc timeout_callback,
-    void (*free_privdata)(RedisModuleCtx *, void *), long long timeout_ms,
-    RedisModuleString **keys, int numkeys, void *privdata) {
+RedisModuleBlockedClient *moduleBlockClient(RedisModuleCtx *ctx, RedisModuleCmdFunc reply_callback, RedisModuleCmdFunc timeout_callback, void (*free_privdata)(RedisModuleCtx*,void*), long long timeout_ms, RedisModuleString **keys, int numkeys, void *privdata) {
@@ -2297,2 +2205,3 @@ RedisModuleBlockedClient *moduleBlockClient(
-    addReplyError(c, islua ? "Blocking module command called from Lua script"
-                           : "Blocking module command called from transaction");
+        addReplyError(c, islua ?
+            "Blocking module command called from Lua script" :
+            "Blocking module command called from transaction");
@@ -2324,14 +2233,5 @@ int moduleTryServeClientBlockedOnKey(client *c, robj *key) {
-RedisModuleBlockedClient *RM_BlockClient(
-    RedisModuleCtx *ctx, RedisModuleCmdFunc reply_callback,
-    RedisModuleCmdFunc timeout_callback,
-    void (*free_privdata)(RedisModuleCtx *, void *), long long timeout_ms) {
-  return moduleBlockClient(ctx, reply_callback, timeout_callback, free_privdata,
-                           timeout_ms, NULL, 0, NULL);
-}
-RedisModuleBlockedClient *RM_BlockClientOnKeys(
-    RedisModuleCtx *ctx, RedisModuleCmdFunc reply_callback,
-    RedisModuleCmdFunc timeout_callback,
-    void (*free_privdata)(RedisModuleCtx *, void *), long long timeout_ms,
-    RedisModuleString **keys, int numkeys, void *privdata) {
-  return moduleBlockClient(ctx, reply_callback, timeout_callback, free_privdata,
-                           timeout_ms, keys, numkeys, privdata);
+RedisModuleBlockedClient *RM_BlockClient(RedisModuleCtx *ctx, RedisModuleCmdFunc reply_callback, RedisModuleCmdFunc timeout_callback, void (*free_privdata)(RedisModuleCtx*,void*), long long timeout_ms) {
+    return moduleBlockClient(ctx,reply_callback,timeout_callback,free_privdata,timeout_ms, NULL,0,NULL);
+}
+RedisModuleBlockedClient *RM_BlockClientOnKeys(RedisModuleCtx *ctx, RedisModuleCmdFunc reply_callback, RedisModuleCmdFunc timeout_callback, void (*free_privdata)(RedisModuleCtx*,void*), long long timeout_ms, RedisModuleString **keys, int numkeys, void *privdata) {
+    return moduleBlockClient(ctx,reply_callback,timeout_callback,free_privdata,timeout_ms, keys,numkeys,privdata);
@@ -2374,2 +2274 @@ int RM_AbortBlock(RedisModuleBlockedClient *bc) {
-void RM_SetDisconnectCallback(RedisModuleBlockedClient *bc,
-                              RedisModuleDisconnectFunc callback) {
+void RM_SetDisconnectCallback(RedisModuleBlockedClient *bc, RedisModuleDisconnectFunc callback) {
@@ -2383,2 +2282 @@ void moduleHandleBlockedClients(void) {
-  while (read(server.module_blocked_pipe[0], buf, 1) == 1)
-    ;
+    while (read(server.module_blocked_pipe[0],buf,1) == 1);
@@ -2404 +2302,2 @@ void moduleHandleBlockedClients(void) {
-      if (c == NULL) ctx.flags |= REDISMODULE_CTX_BLOCKED_DISCONNECTED;
+            if (c == NULL)
+                ctx.flags |= REDISMODULE_CTX_BLOCKED_DISCONNECTED;
@@ -2416 +2315,3 @@ void moduleHandleBlockedClients(void) {
-      if (clientHasPendingReplies(c) && !(c->flags & CLIENT_PENDING_WRITE)) {
+            if (clientHasPendingReplies(c) &&
+                !(c->flags & CLIENT_PENDING_WRITE))
+            {
@@ -2484,4 +2385,7 @@ void RM_ThreadSafeContextUnlock(RedisModuleCtx *ctx) {
-void moduleAcquireGIL(void) { pthread_mutex_lock(&moduleGIL); }
-void moduleReleaseGIL(void) { pthread_mutex_unlock(&moduleGIL); }
-int RM_SubscribeToKeyspaceEvents(RedisModuleCtx *ctx, int types,
-                                 RedisModuleNotificationFunc callback) {
+void moduleAcquireGIL(void) {
+    pthread_mutex_lock(&moduleGIL);
+}
+void moduleReleaseGIL(void) {
+    pthread_mutex_unlock(&moduleGIL);
+}
+int RM_SubscribeToKeyspaceEvents(RedisModuleCtx *ctx, int types, RedisModuleNotificationFunc callback) {
@@ -2496,4 +2400,6 @@ int RM_SubscribeToKeyspaceEvents(RedisModuleCtx *ctx, int types,
-int RM_GetNotifyKeyspaceEvents() { return server.notify_keyspace_events; }
-int RM_NotifyKeyspaceEvent(RedisModuleCtx *ctx, int type, const char *event,
-                           RedisModuleString *key) {
-  if (!ctx || !ctx->client) return REDISMODULE_ERR;
+int RM_GetNotifyKeyspaceEvents() {
+    return server.notify_keyspace_events;
+}
+int RM_NotifyKeyspaceEvent(RedisModuleCtx *ctx, int type, const char *event, RedisModuleString *key) {
+    if (!ctx || !ctx->client)
+        return REDISMODULE_ERR;
@@ -2503,2 +2409 @@ int RM_NotifyKeyspaceEvent(RedisModuleCtx *ctx, int type, const char *event,
-void moduleNotifyKeyspaceEvent(int type, const char *event, robj *key,
-                               int dbid) {
+void moduleNotifyKeyspaceEvent(int type, const char *event, robj *key, int dbid) {
@@ -2536,5 +2441 @@ void moduleUnsubscribeNotifications(RedisModule *module) {
-typedef void (*RedisModuleClusterMessageReceiver)(RedisModuleCtx *ctx,
-                                                  const char *sender_id,
-                                                  uint8_t type,
-                                                  const unsigned char *payload,
-                                                  uint32_t len);
+typedef void (*RedisModuleClusterMessageReceiver)(RedisModuleCtx *ctx, const char *sender_id, uint8_t type, const unsigned char *payload, uint32_t len);
@@ -2554,3 +2455 @@ static moduleClusterReceiver *clusterReceivers[UINT8_MAX];
-void moduleCallClusterReceivers(const char *sender_id, uint64_t module_id,
-                                uint8_t type, const unsigned char *payload,
-                                uint32_t len) {
+void moduleCallClusterReceivers(const char *sender_id, uint64_t module_id, uint8_t type, const unsigned char *payload, uint32_t len) {
@@ -2571,3 +2470 @@ void moduleCallClusterReceivers(const char *sender_id, uint64_t module_id,
-void RM_RegisterClusterMessageReceiver(
-    RedisModuleCtx *ctx, uint8_t type,
-    RedisModuleClusterMessageReceiver callback) {
+void RM_RegisterClusterMessageReceiver(RedisModuleCtx *ctx, uint8_t type, RedisModuleClusterMessageReceiver callback) {
@@ -2602,2 +2499 @@ void RM_RegisterClusterMessageReceiver(
-int RM_SendClusterMessage(RedisModuleCtx *ctx, char *target_id, uint8_t type,
-                          unsigned char *msg, uint32_t len) {
+int RM_SendClusterMessage(RedisModuleCtx *ctx, char *target_id, uint8_t type, unsigned char *msg, uint32_t len) {
@@ -2606,2 +2502 @@ int RM_SendClusterMessage(RedisModuleCtx *ctx, char *target_id, uint8_t type,
-  if (clusterSendModuleMessageToTarget(target_id, module_id, type, msg, len) ==
-      C_OK)
+    if (clusterSendModuleMessageToTarget(target_id,module_id,type,msg,len) == C_OK)
@@ -2645,4 +2540,2 @@ size_t RM_GetClusterSize(void) {
-clusterNode *clusterLookupNode(
-    const char *name);
-int RM_GetClusterNodeInfo(RedisModuleCtx *ctx, const char *id, char *ip,
-                          char *master_id, int *port, int *flags) {
+clusterNode *clusterLookupNode(const char *name);
+int RM_GetClusterNodeInfo(RedisModuleCtx *ctx, const char *id, char *ip, char *master_id, int *port, int *flags) {
@@ -2668,2 +2561 @@ int RM_GetClusterNodeInfo(RedisModuleCtx *ctx, const char *id, char *ip,
-    if (node->flags & CLUSTER_NODE_NOFAILOVER)
-      *flags |= REDISMODULE_NODE_NOFAILOVER;
+        if (node->flags & CLUSTER_NODE_NOFAILOVER) *flags |= REDISMODULE_NODE_NOFAILOVER;
@@ -2689,2 +2581 @@ typedef struct RedisModuleTimer {
-int moduleTimerHandler(struct aeEventLoop *eventLoop, long long id,
-                       void *clientData) {
+int moduleTimerHandler(struct aeEventLoop *eventLoop, long long id, void *clientData) {
@@ -2723,2 +2614 @@ int moduleTimerHandler(struct aeEventLoop *eventLoop, long long id,
-RedisModuleTimerID RM_CreateTimer(RedisModuleCtx *ctx, mstime_t period,
-                                  RedisModuleTimerProc callback, void *data) {
+RedisModuleTimerID RM_CreateTimer(RedisModuleCtx *ctx, mstime_t period, RedisModuleTimerProc callback, void *data) {
@@ -2753,2 +2643 @@ RedisModuleTimerID RM_CreateTimer(RedisModuleCtx *ctx, mstime_t period,
-    aeTimer =
-        aeCreateTimeEvent(server.el, period, moduleTimerHandler, NULL, NULL);
+        aeTimer = aeCreateTimeEvent(server.el,period,moduleTimerHandler,NULL,NULL);
@@ -2766,2 +2655 @@ int RM_StopTimer(RedisModuleCtx *ctx, RedisModuleTimerID id, void **data) {
-int RM_GetTimerInfo(RedisModuleCtx *ctx, RedisModuleTimerID id,
-                    uint64_t *remaining, void **data) {
+int RM_GetTimerInfo(RedisModuleCtx *ctx, RedisModuleTimerID id, uint64_t *remaining, void **data) {
@@ -2790 +2678,3 @@ void RM_FreeDict(RedisModuleCtx *ctx, RedisModuleDict *d) {
-uint64_t RM_DictSize(RedisModuleDict *d) { return raxSize(d->rax); }
+uint64_t RM_DictSize(RedisModuleDict *d) {
+    return raxSize(d->rax);
+}
@@ -2820,2 +2710 @@ int RM_DictDel(RedisModuleDict *d, RedisModuleString *key, void *oldval) {
-RedisModuleDictIter *RM_DictIteratorStartC(RedisModuleDict *d, const char *op,
-                                           void *key, size_t keylen) {
+RedisModuleDictIter *RM_DictIteratorStartC(RedisModuleDict *d, const char *op, void *key, size_t keylen) {
@@ -2828,2 +2717 @@ RedisModuleDictIter *RM_DictIteratorStartC(RedisModuleDict *d, const char *op,
-RedisModuleDictIter *RM_DictIteratorStart(RedisModuleDict *d, const char *op,
-                                          RedisModuleString *key) {
+RedisModuleDictIter *RM_DictIteratorStart(RedisModuleDict *d, const char *op, RedisModuleString *key) {
@@ -2836,2 +2724 @@ void RM_DictIteratorStop(RedisModuleDictIter *di) {
-int RM_DictIteratorReseekC(RedisModuleDictIter *di, const char *op, void *key,
-                           size_t keylen) {
+int RM_DictIteratorReseekC(RedisModuleDictIter *di, const char *op, void *key, size_t keylen) {
@@ -2840,2 +2727 @@ int RM_DictIteratorReseekC(RedisModuleDictIter *di, const char *op, void *key,
-int RM_DictIteratorReseek(RedisModuleDictIter *di, const char *op,
-                          RedisModuleString *key) {
+int RM_DictIteratorReseek(RedisModuleDictIter *di, const char *op, RedisModuleString *key) {
@@ -2856,2 +2742 @@ void *RM_DictPrevC(RedisModuleDictIter *di, size_t *keylen, void **dataptr) {
-RedisModuleString *RM_DictNext(RedisModuleCtx *ctx, RedisModuleDictIter *di,
-                               void **dataptr) {
+RedisModuleString *RM_DictNext(RedisModuleCtx *ctx, RedisModuleDictIter *di, void **dataptr) {
@@ -2863,2 +2748 @@ RedisModuleString *RM_DictNext(RedisModuleCtx *ctx, RedisModuleDictIter *di,
-RedisModuleString *RM_DictPrev(RedisModuleCtx *ctx, RedisModuleDictIter *di,
-                               void **dataptr) {
+RedisModuleString *RM_DictPrev(RedisModuleCtx *ctx, RedisModuleDictIter *di, void **dataptr) {
@@ -2870,2 +2754 @@ RedisModuleString *RM_DictPrev(RedisModuleCtx *ctx, RedisModuleDictIter *di,
-int RM_DictCompareC(RedisModuleDictIter *di, const char *op, void *key,
-                    size_t keylen) {
+int RM_DictCompareC(RedisModuleDictIter *di, const char *op, void *key, size_t keylen) {
@@ -2876,2 +2759 @@ int RM_DictCompareC(RedisModuleDictIter *di, const char *op, void *key,
-int RM_DictCompare(RedisModuleDictIter *di, const char *op,
-                   RedisModuleString *key) {
+int RM_DictCompare(RedisModuleDictIter *di, const char *op, RedisModuleString *key) {
@@ -2887 +2769,2 @@ int RM_InfoAddSection(RedisModuleInfoCtx *ctx, char *name) {
-  if (ctx->in_dict_field) RM_InfoEndDictField(ctx);
+    if (ctx->in_dict_field)
+        RM_InfoEndDictField(ctx);
@@ -2903,3 +2786,8 @@ int RM_InfoBeginDictField(RedisModuleInfoCtx *ctx, char *name) {
-  if (!ctx->in_section) return REDISMODULE_ERR;
-  if (ctx->in_dict_field) RM_InfoEndDictField(ctx);
-  ctx->info = sdscatfmt(ctx->info, "%s_%s:", ctx->module->name, name);
+    if (!ctx->in_section)
+        return REDISMODULE_ERR;
+    if (ctx->in_dict_field)
+        RM_InfoEndDictField(ctx);
+    ctx->info = sdscatfmt(ctx->info,
+        "%s_%s:",
+        ctx->module->name,
+        name);
@@ -2910,2 +2798,4 @@ int RM_InfoEndDictField(RedisModuleInfoCtx *ctx) {
-  if (!ctx->in_dict_field) return REDISMODULE_ERR;
-  if (ctx->info[sdslen(ctx->info) - 1] == ',') sdsIncrLen(ctx->info, -1);
+    if (!ctx->in_dict_field)
+        return REDISMODULE_ERR;
+    if (ctx->info[sdslen(ctx->info)-1]==',')
+        sdsIncrLen(ctx->info, -1);
@@ -2916,3 +2806,3 @@ int RM_InfoEndDictField(RedisModuleInfoCtx *ctx) {
-int RM_InfoAddFieldString(RedisModuleInfoCtx *ctx, char *field,
-                          RedisModuleString *value) {
-  if (!ctx->in_section) return REDISMODULE_ERR;
+int RM_InfoAddFieldString(RedisModuleInfoCtx *ctx, char *field, RedisModuleString *value) {
+    if (!ctx->in_section)
+        return REDISMODULE_ERR;
@@ -2920 +2810,4 @@ int RM_InfoAddFieldString(RedisModuleInfoCtx *ctx, char *field,
-    ctx->info = sdscatfmt(ctx->info, "%s=%S,", field, (sds)value->ptr);
+        ctx->info = sdscatfmt(ctx->info,
+            "%s=%S,",
+            field,
+            (sds)value->ptr);
@@ -2923 +2816,4 @@ int RM_InfoAddFieldString(RedisModuleInfoCtx *ctx, char *field,
-  ctx->info = sdscatfmt(ctx->info, "%s_%s:%S\r\n", ctx->module->name, field,
+    ctx->info = sdscatfmt(ctx->info,
+        "%s_%s:%S\r\n",
+        ctx->module->name,
+        field,
@@ -2928 +2824,2 @@ int RM_InfoAddFieldCString(RedisModuleInfoCtx *ctx, char *field, char *value) {
-  if (!ctx->in_section) return REDISMODULE_ERR;
+    if (!ctx->in_section)
+        return REDISMODULE_ERR;
@@ -2930 +2827,4 @@ int RM_InfoAddFieldCString(RedisModuleInfoCtx *ctx, char *field, char *value) {
-    ctx->info = sdscatfmt(ctx->info, "%s=%s,", field, value);
+        ctx->info = sdscatfmt(ctx->info,
+            "%s=%s,",
+            field,
+            value);
@@ -2933,2 +2833,5 @@ int RM_InfoAddFieldCString(RedisModuleInfoCtx *ctx, char *field, char *value) {
-  ctx->info =
-      sdscatfmt(ctx->info, "%s_%s:%s\r\n", ctx->module->name, field, value);
+    ctx->info = sdscatfmt(ctx->info,
+        "%s_%s:%s\r\n",
+        ctx->module->name,
+        field,
+        value);
@@ -2938 +2841,2 @@ int RM_InfoAddFieldDouble(RedisModuleInfoCtx *ctx, char *field, double value) {
-  if (!ctx->in_section) return REDISMODULE_ERR;
+    if (!ctx->in_section)
+        return REDISMODULE_ERR;
@@ -2940 +2844,4 @@ int RM_InfoAddFieldDouble(RedisModuleInfoCtx *ctx, char *field, double value) {
-    ctx->info = sdscatprintf(ctx->info, "%s=%.17g,", field, value);
+        ctx->info = sdscatprintf(ctx->info,
+            "%s=%.17g,",
+            field,
+            value);
@@ -2943,2 +2850,5 @@ int RM_InfoAddFieldDouble(RedisModuleInfoCtx *ctx, char *field, double value) {
-  ctx->info = sdscatprintf(ctx->info, "%s_%s:%.17g\r\n", ctx->module->name,
-                           field, value);
+    ctx->info = sdscatprintf(ctx->info,
+        "%s_%s:%.17g\r\n",
+        ctx->module->name,
+        field,
+        value);
@@ -2947,3 +2857,3 @@ int RM_InfoAddFieldDouble(RedisModuleInfoCtx *ctx, char *field, double value) {
-int RM_InfoAddFieldLongLong(RedisModuleInfoCtx *ctx, char *field,
-                            long long value) {
-  if (!ctx->in_section) return REDISMODULE_ERR;
+int RM_InfoAddFieldLongLong(RedisModuleInfoCtx *ctx, char *field, long long value) {
+    if (!ctx->in_section)
+        return REDISMODULE_ERR;
@@ -2951 +2861,4 @@ int RM_InfoAddFieldLongLong(RedisModuleInfoCtx *ctx, char *field,
-    ctx->info = sdscatfmt(ctx->info, "%s=%I,", field, value);
+        ctx->info = sdscatfmt(ctx->info,
+            "%s=%I,",
+            field,
+            value);
@@ -2954,2 +2867,5 @@ int RM_InfoAddFieldLongLong(RedisModuleInfoCtx *ctx, char *field,
-  ctx->info =
-      sdscatfmt(ctx->info, "%s_%s:%I\r\n", ctx->module->name, field, value);
+    ctx->info = sdscatfmt(ctx->info,
+        "%s_%s:%I\r\n",
+        ctx->module->name,
+        field,
+        value);
@@ -2958,3 +2874,3 @@ int RM_InfoAddFieldLongLong(RedisModuleInfoCtx *ctx, char *field,
-int RM_InfoAddFieldULongLong(RedisModuleInfoCtx *ctx, char *field,
-                             unsigned long long value) {
-  if (!ctx->in_section) return REDISMODULE_ERR;
+int RM_InfoAddFieldULongLong(RedisModuleInfoCtx *ctx, char *field, unsigned long long value) {
+    if (!ctx->in_section)
+        return REDISMODULE_ERR;
@@ -2962 +2878,4 @@ int RM_InfoAddFieldULongLong(RedisModuleInfoCtx *ctx, char *field,
-    ctx->info = sdscatfmt(ctx->info, "%s=%U,", field, value);
+        ctx->info = sdscatfmt(ctx->info,
+            "%s=%U,",
+            field,
+            value);
@@ -2965,2 +2884,5 @@ int RM_InfoAddFieldULongLong(RedisModuleInfoCtx *ctx, char *field,
-  ctx->info =
-      sdscatfmt(ctx->info, "%s_%s:%U\r\n", ctx->module->name, field, value);
+    ctx->info = sdscatfmt(ctx->info,
+        "%s_%s:%U\r\n",
+        ctx->module->name,
+        field,
+        value);
@@ -2973,2 +2895 @@ int RM_RegisterInfoFunc(RedisModuleCtx *ctx, RedisModuleInfoFunc cb) {
-sds modulesCollectInfo(sds info, const char *section, int for_crash_report,
-                       int sections) {
+sds modulesCollectInfo(sds info, const char *section, int for_crash_report, int sections) {
@@ -2979 +2900,2 @@ sds modulesCollectInfo(sds info, const char *section, int for_crash_report,
-    if (!module->info_cb) continue;
+        if (!module->info_cb)
+            continue;
@@ -2982 +2904,2 @@ sds modulesCollectInfo(sds info, const char *section, int for_crash_report,
-    if (info_ctx.in_dict_field) RM_InfoEndDictField(&info_ctx);
+        if (info_ctx.in_dict_field)
+            RM_InfoEndDictField(&info_ctx);
@@ -2989,2 +2912 @@ sds modulesCollectInfo(sds info, const char *section, int for_crash_report,
-RedisModuleServerInfoData *RM_GetServerInfo(RedisModuleCtx *ctx,
-                                            const char *section) {
+RedisModuleServerInfoData *RM_GetServerInfo(RedisModuleCtx *ctx, const char *section) {
@@ -3004,3 +2926,3 @@ RedisModuleServerInfoData *RM_GetServerInfo(RedisModuleCtx *ctx,
-    sds val =
-        sdsnewlen(sep + 1, sdslen(line) - ((intptr_t)sep - (intptr_t)line) - 1);
-    if (!raxTryInsert(d->rax, key, keylen, val, NULL)) sdsfree(val);
+        sds val = sdsnewlen(sep+1,sdslen(line)-((intptr_t)sep-(intptr_t)line)-1);
+        if (!raxTryInsert(d->rax,key,keylen,val,NULL))
+            sdsfree(val);
@@ -3026,3 +2948 @@ void RM_FreeServerInfo(RedisModuleCtx *ctx, RedisModuleServerInfoData *data) {
-RedisModuleString *RM_ServerInfoGetField(RedisModuleCtx *ctx,
-                                         RedisModuleServerInfoData *data,
-                                         const char *field) {
+RedisModuleString *RM_ServerInfoGetField(RedisModuleCtx *ctx, RedisModuleServerInfoData *data, const char* field) {
@@ -3035,2 +2955 @@ RedisModuleString *RM_ServerInfoGetField(RedisModuleCtx *ctx,
-const char *RM_ServerInfoGetFieldC(RedisModuleServerInfoData *data,
-                                   const char *field) {
+const char *RM_ServerInfoGetFieldC(RedisModuleServerInfoData *data, const char* field) {
@@ -3041,2 +2960 @@ const char *RM_ServerInfoGetFieldC(RedisModuleServerInfoData *data,
-long long RM_ServerInfoGetFieldSigned(RedisModuleServerInfoData *data,
-                                      const char *field, int *out_err) {
+long long RM_ServerInfoGetFieldSigned(RedisModuleServerInfoData *data, const char* field, int *out_err) {
@@ -3056,2 +2974 @@ long long RM_ServerInfoGetFieldSigned(RedisModuleServerInfoData *data,
-unsigned long long RM_ServerInfoGetFieldUnsigned(
-    RedisModuleServerInfoData *data, const char *field, int *out_err) {
+unsigned long long RM_ServerInfoGetFieldUnsigned(RedisModuleServerInfoData *data, const char* field, int *out_err) {
@@ -3071,2 +2988 @@ unsigned long long RM_ServerInfoGetFieldUnsigned(
-double RM_ServerInfoGetFieldDouble(RedisModuleServerInfoData *data,
-                                   const char *field, int *out_err) {
+double RM_ServerInfoGetFieldDouble(RedisModuleServerInfoData *data, const char* field, int *out_err) {
@@ -3159,2 +3075 @@ int moduleUnregisterFilters(RedisModule *module) {
-RedisModuleCommandFilter *RM_RegisterCommandFilter(
-    RedisModuleCtx *ctx, RedisModuleCommandFilterFunc callback, int flags) {
+RedisModuleCommandFilter *RM_RegisterCommandFilter(RedisModuleCtx *ctx, RedisModuleCommandFilterFunc callback, int flags) {
@@ -3169,2 +3084 @@ RedisModuleCommandFilter *RM_RegisterCommandFilter(
-int RM_UnregisterCommandFilter(RedisModuleCtx *ctx,
-                               RedisModuleCommandFilter *filter) {
+int RM_UnregisterCommandFilter(RedisModuleCtx *ctx, RedisModuleCommandFilter *filter) {
@@ -3187 +3101,4 @@ void moduleCallCommandFilters(client *c) {
-  RedisModuleCommandFilterCtx filter = {.argv = c->argv, .argc = c->argc};
+    RedisModuleCommandFilterCtx filter = {
+        .argv = c->argv,
+        .argc = c->argc
+    };
@@ -3190,2 +3107 @@ void moduleCallCommandFilters(client *c) {
-    if ((f->flags & REDISMODULE_CMDFILTER_NOSELF) && f->module->in_call)
-      continue;
+        if ((f->flags & REDISMODULE_CMDFILTER_NOSELF) && f->module->in_call) continue;
@@ -3197 +3113,2 @@ void moduleCallCommandFilters(client *c) {
-int RM_CommandFilterArgsCount(RedisModuleCommandFilterCtx *fctx) {
+int RM_CommandFilterArgsCount(RedisModuleCommandFilterCtx *fctx)
+{
@@ -3200,2 +3117,2 @@ int RM_CommandFilterArgsCount(RedisModuleCommandFilterCtx *fctx) {
-const RedisModuleString *RM_CommandFilterArgGet(
-    RedisModuleCommandFilterCtx *fctx, int pos) {
+const RedisModuleString *RM_CommandFilterArgGet(RedisModuleCommandFilterCtx *fctx, int pos)
+{
@@ -3205,2 +3122,2 @@ const RedisModuleString *RM_CommandFilterArgGet(
-int RM_CommandFilterArgInsert(RedisModuleCommandFilterCtx *fctx, int pos,
-                              RedisModuleString *arg) {
+int RM_CommandFilterArgInsert(RedisModuleCommandFilterCtx *fctx, int pos, RedisModuleString *arg)
+{
@@ -3209,2 +3126 @@ int RM_CommandFilterArgInsert(RedisModuleCommandFilterCtx *fctx, int pos,
-  fctx->argv =
-      zrealloc(fctx->argv, (fctx->argc + 1) * sizeof(RedisModuleString *));
+    fctx->argv = zrealloc(fctx->argv, (fctx->argc+1)*sizeof(RedisModuleString *));
@@ -3218,2 +3134,2 @@ int RM_CommandFilterArgInsert(RedisModuleCommandFilterCtx *fctx, int pos,
-int RM_CommandFilterArgReplace(RedisModuleCommandFilterCtx *fctx, int pos,
-                               RedisModuleString *arg) {
+int RM_CommandFilterArgReplace(RedisModuleCommandFilterCtx *fctx, int pos, RedisModuleString *arg)
+{
@@ -3225 +3141,2 @@ int RM_CommandFilterArgReplace(RedisModuleCommandFilterCtx *fctx, int pos,
-int RM_CommandFilterArgDelete(RedisModuleCommandFilterCtx *fctx, int pos) {
+int RM_CommandFilterArgDelete(RedisModuleCommandFilterCtx *fctx, int pos)
+{
@@ -3235 +3152,3 @@ int RM_CommandFilterArgDelete(RedisModuleCommandFilterCtx *fctx, int pos) {
-size_t RM_MallocSize(void *ptr) { return zmalloc_size(ptr); }
+size_t RM_MallocSize(void* ptr){
+    return zmalloc_size(ptr);
+}
@@ -3241,3 +3160 @@ float RM_GetUsedMemoryRatio() {
-typedef void (*RedisModuleScanCB)(RedisModuleCtx *ctx,
-                                  RedisModuleString *keyname,
-                                  RedisModuleKey *key, void *privdata);
+typedef void (*RedisModuleScanCB)(RedisModuleCtx *ctx, RedisModuleString *keyname, RedisModuleKey *key, void *privdata);
@@ -3274,3 +3191,4 @@ void RM_ScanCursorRestart(RedisModuleScanCursor *cursor) {
-void RM_ScanCursorDestroy(RedisModuleScanCursor *cursor) { zfree(cursor); }
-int RM_Scan(RedisModuleCtx *ctx, RedisModuleScanCursor *cursor,
-            RedisModuleScanCB fn, void *privdata) {
+void RM_ScanCursorDestroy(RedisModuleScanCursor *cursor) {
+    zfree(cursor);
+}
+int RM_Scan(RedisModuleCtx *ctx, RedisModuleScanCursor *cursor, RedisModuleScanCB fn, void *privdata) {
@@ -3283,2 +3201 @@ int RM_Scan(RedisModuleCtx *ctx, RedisModuleScanCursor *cursor,
-  cursor->cursor = dictScan(ctx->client->db->dict, cursor->cursor,
-                            moduleScanCallback, NULL, &data);
+    cursor->cursor = dictScan(ctx->client->db->dict, cursor->cursor, moduleScanCallback, NULL, &data);
@@ -3292,3 +3209 @@ int RM_Scan(RedisModuleCtx *ctx, RedisModuleScanCursor *cursor,
-typedef void (*RedisModuleScanKeyCB)(RedisModuleKey *key,
-                                     RedisModuleString *field,
-                                     RedisModuleString *value, void *privdata);
+typedef void (*RedisModuleScanKeyCB)(RedisModuleKey *key, RedisModuleString *field, RedisModuleString *value, void *privdata);
@@ -3319,2 +3234 @@ static void moduleScanKeyCallback(void *privdata, const dictEntry *de) {
-int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-               RedisModuleScanKeyCB fn, void *privdata) {
+int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor, RedisModuleScanKeyCB fn, void *privdata) {
@@ -3328 +3242,2 @@ int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-    if (o->encoding == OBJ_ENCODING_HT) ht = o->ptr;
+        if (o->encoding == OBJ_ENCODING_HT)
+            ht = o->ptr;
@@ -3330 +3245,2 @@ int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-    if (o->encoding == OBJ_ENCODING_HT) ht = o->ptr;
+        if (o->encoding == OBJ_ENCODING_HT)
+            ht = o->ptr;
@@ -3332 +3248,2 @@ int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-    if (o->encoding == OBJ_ENCODING_SKIPLIST) ht = ((zset *)o->ptr)->dict;
+        if (o->encoding == OBJ_ENCODING_SKIPLIST)
+            ht = ((zset *)o->ptr)->dict;
@@ -3344,2 +3261 @@ int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-    cursor->cursor =
-        dictScan(ht, cursor->cursor, moduleScanKeyCallback, NULL, &data);
+        cursor->cursor = dictScan(ht, cursor->cursor, moduleScanKeyCallback, NULL, &data);
@@ -3368,2 +3284,3 @@ int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-      robj *field = (vstr != NULL) ? createStringObject((char *)vstr, vlen)
-                                   : createStringObjectFromLongLong(vll);
+            robj *field = (vstr != NULL) ?
+                createStringObject((char*)vstr,vlen) :
+                createStringObjectFromLongLong(vll);
@@ -3372,2 +3289,3 @@ int RM_ScanKey(RedisModuleKey *key, RedisModuleScanCursor *cursor,
-      robj *value = (vstr != NULL) ? createStringObject((char *)vstr, vlen)
-                                   : createStringObjectFromLongLong(vll);
+            robj *value = (vstr != NULL) ?
+                createStringObject((char*)vstr,vlen) :
+                createStringObjectFromLongLong(vll);
@@ -3411,2 +3329,2 @@ int TerminateModuleForkChild(int child_pid, int wait) {
-  if (server.module_child_pid == -1 || server.module_child_pid != child_pid)
-    return C_ERR;
+    if (server.module_child_pid == -1 ||
+        server.module_child_pid != child_pid) return C_ERR;
@@ -3418,2 +3336 @@ int TerminateModuleForkChild(int child_pid, int wait) {
-           server.module_child_pid)
-      ;
+              server.module_child_pid);
@@ -3435 +3352,2 @@ void ModuleForkDoneHandler(int exitcode, int bysignal) {
-  serverLog(LL_NOTICE, "Module fork exited pid: %d, retcode: %d, bysignal: %d",
+    serverLog(LL_NOTICE,
+        "Module fork exited pid: %d, retcode: %d, bysignal: %d",
@@ -3445,2 +3363 @@ void ModuleForkDoneHandler(int exitcode, int bysignal) {
-int RM_SubscribeToServerEvent(RedisModuleCtx *ctx, RedisModuleEvent event,
-                              RedisModuleEventCallback callback) {
+int RM_SubscribeToServerEvent(RedisModuleCtx *ctx, RedisModuleEvent event, RedisModuleEventCallback callback) {
@@ -3496 +3413,2 @@ void moduleFireServerEvent(uint64_t eid, int subid, void *data) {
-        modulePopulateClientInfoStructure(&civ1, data, el->event.dataver);
+                modulePopulateClientInfoStructure(&civ1,data,
+                                                  el->event.dataver);
@@ -3504 +3422,2 @@ void moduleFireServerEvent(uint64_t eid, int subid, void *data) {
-        if (fi->dbnum != -1) selectDb(ctx.client, fi->dbnum);
+                if (fi->dbnum != -1)
+                    selectDb(ctx.client, fi->dbnum);
@@ -3507 +3426,2 @@ void moduleFireServerEvent(uint64_t eid, int subid, void *data) {
-        if (m == el->module) continue;
+                if (m == el->module)
+                    continue;
@@ -3546,2 +3466 @@ void processModuleLoadingProgressEvent(int is_aof) {
-      progress =
-          (server.loading_total_bytes << 10) / server.loading_total_bytes;
+            progress = (server.loading_total_bytes<<10) / server.loading_total_bytes;
@@ -3549 +3468,2 @@ void processModuleLoadingProgressEvent(int is_aof) {
-                                 server.hz, progress};
+                                     server.hz,
+                                     progress};
@@ -3551,2 +3471,3 @@ void processModuleLoadingProgressEvent(int is_aof) {
-                          is_aof ? REDISMODULE_SUBEVENT_LOADING_PROGRESS_AOF
-                                 : REDISMODULE_SUBEVENT_LOADING_PROGRESS_RDB,
+                              is_aof?
+                                REDISMODULE_SUBEVENT_LOADING_PROGRESS_AOF:
+                                REDISMODULE_SUBEVENT_LOADING_PROGRESS_RDB,
@@ -3574,0 +3496,2 @@ int moduleRegisterApi(const char *funcname, void *funcptr) {
+#define REGISTER_API(name) \
+    moduleRegisterApi("RedisModule_" #name, (void *)(unsigned long)RM_ ## name)
@@ -3604,3 +3527,5 @@ void moduleLoadFromQueue(void) {
-    if (moduleLoad(loadmod->path, (void **)loadmod->argv, loadmod->argc) ==
-        C_ERR) {
-      serverLog(LL_WARNING, "Can't load module from %s: server aborting",
+        if (moduleLoad(loadmod->path,(void **)loadmod->argv,loadmod->argc)
+            == C_ERR)
+        {
+            serverLog(LL_WARNING,
+                "Can't load module from %s: server aborting",
@@ -3626 +3551,2 @@ void moduleUnregisterCommands(struct RedisModule *module) {
-      RedisModuleCommandProxy *cp = (void *)(unsigned long)cmd->getkeys_proc;
+            RedisModuleCommandProxy *cp =
+                (void*)(unsigned long)cmd->getkeys_proc;
@@ -3644 +3570,2 @@ int moduleLoad(const char *path, void **module_argv, int module_argc) {
-  if (stat(path, &st) == 0) {
+    if (stat(path, &st) == 0)
+    {
@@ -3646,4 +3573 @@ int moduleLoad(const char *path, void **module_argv, int module_argc) {
-      serverLog(
-          LL_WARNING,
-          "Module %s failed to load: It does not have execute permissions.",
-          path);
+            serverLog(LL_WARNING, "Module %s failed to load: It does not have execute permissions.", path);
@@ -3658,2 +3582 @@ int moduleLoad(const char *path, void **module_argv, int module_argc) {
-  onload = (int (*)(void *, void **, int))(unsigned long)dlsym(
-      handle, "RedisModule_OnLoad");
+    onload = (int (*)(void *, void **, int))(unsigned long) dlsym(handle,"RedisModule_OnLoad");
@@ -3664,2 +3587 @@ int moduleLoad(const char *path, void **module_argv, int module_argc) {
-              "symbol. Module not loaded.",
-              path);
+            "symbol. Module not loaded.",path);
@@ -3676,2 +3598,2 @@ int moduleLoad(const char *path, void **module_argv, int module_argc) {
-    serverLog(LL_WARNING, "Module %s initialization failed. Module not loaded",
-              path);
+        serverLog(LL_WARNING,
+            "Module %s initialization failed. Module not loaded",path);
@@ -3685 +3607,2 @@ int moduleLoad(const char *path, void **module_argv, int module_argc) {
-                        REDISMODULE_SUBEVENT_MODULE_LOADED, ctx.module);
+                          REDISMODULE_SUBEVENT_MODULE_LOADED,
+                          ctx.module);
@@ -3705,2 +3628 @@ int moduleUnload(sds name) {
-  onunload = (int (*)(void *))(unsigned long)dlsym(module->handle,
-                                                   "RedisModule_OnUnload");
+    onunload = (int (*)(void *))(unsigned long) dlsym(module->handle, "RedisModule_OnUnload");
@@ -3714,2 +3636 @@ int moduleUnload(sds name) {
-      serverLog(LL_WARNING, "Module %s OnUnload failed.  Unload canceled.",
-                name);
+            serverLog(LL_WARNING, "Module %s OnUnload failed.  Unload canceled.", name);
@@ -3733 +3654,2 @@ int moduleUnload(sds name) {
-                        REDISMODULE_SUBEVENT_MODULE_UNLOADED, module);
+                          REDISMODULE_SUBEVENT_MODULE_UNLOADED,
+                          module);
@@ -3803 +3725,3 @@ void moduleCommand(client *c) {
-        "UNLOAD <name> -- Unload a module.", NULL};
+"UNLOAD <name> -- Unload a module.",
+NULL
+        };
@@ -3805 +3729,2 @@ void moduleCommand(client *c) {
-  } else if (!strcasecmp(subcmd, "load") && c->argc >= 3) {
+    } else
+    if (!strcasecmp(subcmd,"load") && c->argc >= 3) {
@@ -3815,2 +3740,2 @@ void moduleCommand(client *c) {
-      addReplyError(
-          c, "Error loading the extension. Please check the server logs.");
+            addReplyError(c,
+                "Error loading the extension. Please check the server logs.");
@@ -3827,2 +3752 @@ void moduleCommand(client *c) {
-          errmsg =
-              "the module exports one or more module-side data "
+                errmsg = "the module exports one or more module-side data "
@@ -3832,2 +3756 @@ void moduleCommand(client *c) {
-          errmsg =
-              "the module exports APIs used by other modules. "
+                errmsg = "the module exports APIs used by other modules. "
@@ -3837,2 +3760 @@ void moduleCommand(client *c) {
-          errmsg =
-              "the module has blocked clients. "
+                errmsg = "the module has blocked clients. "
@@ -3854 +3776,3 @@ void moduleCommand(client *c) {
-size_t moduleCount(void) { return dictSize(modules); }
+size_t moduleCount(void) {
+    return dictSize(modules);
+}
@@ -3856,3 +3780,3 @@ int RM_SetLRU(RedisModuleKey *key, mstime_t lru_idle) {
-  if (!key->value) return REDISMODULE_ERR;
-  if (objectSetLRUOrLFU(key->value, -1, lru_idle,
-                        lru_idle >= 0 ? LRU_CLOCK() : 0, 1))
+    if (!key->value)
+        return REDISMODULE_ERR;
+    if (objectSetLRUOrLFU(key->value, -1, lru_idle, lru_idle>=0 ? LRU_CLOCK() : 0, 1))
@@ -3864,2 +3788,4 @@ int RM_GetLRU(RedisModuleKey *key, mstime_t *lru_idle) {
-  if (!key->value) return REDISMODULE_ERR;
-  if (server.maxmemory_policy & MAXMEMORY_FLAG_LFU) return REDISMODULE_OK;
+    if (!key->value)
+        return REDISMODULE_ERR;
+    if (server.maxmemory_policy & MAXMEMORY_FLAG_LFU)
+        return REDISMODULE_OK;
@@ -3870,2 +3796,4 @@ int RM_SetLFU(RedisModuleKey *key, long long lfu_freq) {
-  if (!key->value) return REDISMODULE_ERR;
-  if (objectSetLRUOrLFU(key->value, lfu_freq, -1, 0, 1)) return REDISMODULE_OK;
+    if (!key->value)
+        return REDISMODULE_ERR;
+    if (objectSetLRUOrLFU(key->value, lfu_freq, -1, 0, 1))
+        return REDISMODULE_OK;
@@ -3876 +3804,2 @@ int RM_GetLFU(RedisModuleKey *key, long long *lfu_freq) {
-  if (!key->value) return REDISMODULE_ERR;
+    if (!key->value)
+        return REDISMODULE_ERR;
@@ -3881,4 +3810,5 @@ int RM_GetLFU(RedisModuleKey *key, long long *lfu_freq) {
-void *RM_ModuleTypeReplaceValue(RedisModuleKey *key, moduleType *mt,
-                                void *new_value) {
-  if (!(key->mode & REDISMODULE_WRITE) || key->iter) return NULL;
-  if (!key->value || key->value->type != OBJ_MODULE) return NULL;
+void *RM_ModuleTypeReplaceValue(RedisModuleKey *key, moduleType *mt, void *new_value) {
+    if (!(key->mode & REDISMODULE_WRITE) || key->iter)
+        return NULL;
+    if (!key->value || key->value->type != OBJ_MODULE)
+        return NULL;
@@ -3886 +3816,2 @@ void *RM_ModuleTypeReplaceValue(RedisModuleKey *key, moduleType *mt,
-  if (mv->type != mt) return NULL;
+    if (mv->type != mt)
+        return NULL;
